     1                                 %line 1+1 a10procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 [section .data]
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 TRUE equ 1
    28                                 FALSE equ 0
    29                                 
    30                                 SUCCESS equ 0
    31                                 NOSUCCESS equ 1
    32                                 
    33                                 STDIN equ 0
    34                                 STDOUT equ 1
    35                                 STDERR equ 2
    36                                 
    37                                 SYS_read equ 0
    38                                 SYS_write equ 1
    39                                 SYS_open equ 2
    40                                 SYS_close equ 3
    41                                 SYS_fork equ 57
    42                                 SYS_exit equ 60
    43                                 SYS_creat equ 85
    44                                 SYS_time equ 201
    45                                 
    46                                 LF equ 10
    47                                 SPACE equ " "
    48                                 NULL equ 0
    49                                 ESC equ 27
    50                                 
    51                                 
    52                                 
    53                                 
    54                                 GL_COLOR_BUFFER_BIT equ 16384
    55                                 GL_POINTS equ 0
    56                                 GL_POLYGON equ 9
    57                                 GL_PROJECTION equ 5889
    58                                 
    59                                 GLUT_RGB equ 0
    60                                 GLUT_SINGLE equ 0
    61                                 
    62                                 
    63                                 
    64                                 
    65                                 R1_MIN equ 0
    66                                 R1_MAX equ 250
    67                                 
    68                                 R2_MIN equ 1
    69                                 R2_MAX equ 250
    70                                 
    71                                 OP_MIN equ 1
    72                                 OP_MAX equ 250
    73                                 
    74                                 SP_MIN equ 1
    75                                 SP_MAX equ 100
    76                                 
    77                                 X_OFFSET equ 320
    78                                 Y_OFFSET equ 240
    79                                 
    80                                 
    81                                 
    82                                 
    83 00000000 55736167653A20202E-    errUsage db "Usage:  ./spiro -r1 <senary number> "
    84 00000000 2F737069726F202D72-
    85 00000000 31203C73656E617279-
    86 00000000 206E756D6265723E20 
    87 00000024 2D7232203C73656E61-     db "-r2 <senary number> -op <senary number> "
    88 00000024 7279206E756D626572-
    89 00000024 3E202D6F70203C7365-
    90 00000024 6E617279206E756D62-
    91 00000024 65723E20           
    92 0000004C 2D7370203C73656E61-     db "-sp <senary number> -cl <b/g/r/y/p/w>"
    93 0000004C 7279206E756D626572-
    94 0000004C 3E202D636C203C622F-
    95 0000004C 672F722F792F702F77-
    96 0000004C 3E                 
    97 00000071 0A00                    db LF, NULL
    98 00000073 4572726F722C20696E-    errBadCL db "Error, invalid or incomplete command line arguments."
    99 00000073 76616C6964206F7220-
   100 00000073 696E636F6D706C6574-
   101 00000073 6520636F6D6D616E64-
   102 00000073 206C696E6520617267-
   103 00000073 756D656E74732E     
   104 000000A7 0A00                    db LF, NULL
   105                                 
   106 000000A9 4572726F722C207261-    errR1sp db "Error, radius 1 specifier incorrect."
   107 000000A9 646975732031207370-
   108 000000A9 656369666965722069-
   109 000000A9 6E636F72726563742E 
   110 000000CD 0A00                    db LF, NULL
   111 000000CF 4572726F722C207261-    errR1value db "Error, radius 1 value must be between 0 and 1054(6)."
   112 000000CF 646975732031207661-
   113 000000CF 6C7565206D75737420-
   114 000000CF 626520626574776565-
   115 000000CF 6E203020616E642031-
   116 000000CF 3035342836292E     
   117 00000103 0A00                    db LF, NULL
   118                                 
   119 00000105 4572726F722C207261-    errR2sp db "Error, radius 2 specifier incorrect."
   120 00000105 646975732032207370-
   121 00000105 656369666965722069-
   122 00000105 6E636F72726563742E 
   123 00000129 0A00                    db LF, NULL
   124 0000012B 4572726F722C207261-    errR2value db "Error, radius 2 value must be between 1 and 1054(6)."
   125 0000012B 646975732032207661-
   126 0000012B 6C7565206D75737420-
   127 0000012B 626520626574776565-
   128 0000012B 6E203120616E642031-
   129 0000012B 3035342836292E     
   130 0000015F 0A00                    db LF, NULL
   131                                 
   132 00000161 4572726F722C206F66-    errOPsp db "Error, offset position specifier incorrect."
   133 00000161 6673657420706F7369-
   134 00000161 74696F6E2073706563-
   135 00000161 696669657220696E63-
   136 00000161 6F72726563742E     
   137 0000018C 0A00                    db LF, NULL
   138 0000018E 4572726F722C206F66-    errOPvalue db "Error, offset position value must be between 1 and 1054(6)."
   139 0000018E 6673657420706F7369-
   140 0000018E 74696F6E2076616C75-
   141 0000018E 65206D757374206265-
   142 0000018E 206265747765656E20-
   143 0000018E 3120616E6420313035-
   144 0000018E 342836292E         
   145 000001C9 0A00                    db LF, NULL
   146                                 
   147 000001CB 4572726F722C207370-    errSPsp db "Error, speed specifier incorrect."
   148 000001CB 656564207370656369-
   149 000001CB 6669657220696E636F-
   150 000001CB 72726563742E       
   151 000001EC 0A00                    db LF, NULL
   152 000001EE 4572726F722C207370-    errSPvalue db "Error, speed value must be between 1 and 244(6)."
   153 000001EE 6565642076616C7565-
   154 000001EE 206D75737420626520-
   155 000001EE 6265747765656E2031-
   156 000001EE 20616E642032343428-
   157 000001EE 36292E             
   158 0000021E 0A00                    db LF, NULL
   159                                 
   160 00000220 4572726F722C20636F-    errCLsp db "Error, color specifier incorrect."
   161 00000220 6C6F72207370656369-
   162 00000220 6669657220696E636F-
   163 00000220 72726563742E       
   164 00000241 0A00                    db LF, NULL
   165 00000243 4572726F722C20636F-    errCLvalue db "Error, color value must be b, g, r, p, or w. "
   166 00000243 6C6F722076616C7565-
   167 00000243 206D75737420626520-
   168 00000243 622C20672C20722C20-
   169 00000243 702C206F7220772E20 
   170 00000270 0A00                    db LF, NULL
   171                                 
   172                                 
   173                                 
   174                                 
   175 00000272 0000803F               fltOne dd 1.0
   176 00000276 00000000               fltZero dd 0.0
   177 0000027A 00000000               fltTmp1 dd 0.0
   178 0000027E 00000000               fltTmp2 dd 0.0
   179                                 
   180 00000282 00000000               t dd 0.0
   181 00000286 0000803F               s dd 1.0
   182 0000028A 0AD7A33B               tStep dd 0.005
   183 0000028E 00000000               sStep dd 0.0
   184 00000292 00000000               x dd 0
   185 00000296 00000000               y dd 0
   186                                 
   187 0000029A 00000000               r1 dd 0.0
   188 0000029E 00000000               r2 dd 0.0
   189 000002A2 00000000               ofp dd 0.0
   190 000002A6 00000000               radii dd 0.0
   191                                 
   192 000002AA 00409C45               scale dd 5000.0
   193 000002AE 0000B443               limit dd 360.0
   194 000002B2 00000000               iterations dd 0
   195                                 
   196 000002B6 00                     red db 0
   197 000002B7 00                     green db 0
   198 000002B8 00                     blue db 0
   199                                 
   200                                 
   201                                 
   202                                 [section .text]
   203                                 
   204                                 
   205                                 
   206                                 
   207                                 [extern glutInit]
   208                                 %line 149+0 a10procs.asm
   209                                 [extern glutInitDisplayMode]
   210                                 [extern glutInitWindowSize]
   211                                 [extern glutInitWindowPosition]
   212                                 %line 150+1 a10procs.asm
   213                                 [extern glutCreateWindow]
   214                                 %line 150+0 a10procs.asm
   215                                 [extern glutMainLoop]
   216                                 %line 151+1 a10procs.asm
   217                                 [extern glutDisplayFunc]
   218                                 %line 151+0 a10procs.asm
   219                                 [extern glutIdleFunc]
   220                                 [extern glutReshapeFunc]
   221                                 [extern glutKeyboardFunc]
   222                                 %line 152+1 a10procs.asm
   223                                 [extern glutSwapBuffers]
   224                                 %line 152+0 a10procs.asm
   225                                 [extern gluPerspective]
   226                                 [extern glutPostRedisplay]
   227                                 %line 153+1 a10procs.asm
   228                                 [extern glClearColor]
   229                                 %line 153+0 a10procs.asm
   230                                 [extern glClearDepth]
   231                                 [extern glDepthFunc]
   232                                 [extern glEnable]
   233                                 [extern glShadeModel]
   234                                 %line 154+1 a10procs.asm
   235                                 [extern glClear]
   236                                 %line 154+0 a10procs.asm
   237                                 [extern glLoadIdentity]
   238                                 [extern glMatrixMode]
   239                                 [extern glViewport]
   240                                 %line 155+1 a10procs.asm
   241                                 [extern glTranslatef]
   242                                 %line 155+0 a10procs.asm
   243                                 [extern glRotatef]
   244                                 [extern glBegin]
   245                                 [extern glEnd]
   246                                 [extern glVertex3f]
   247                                 [extern glColor3f]
   248                                 %line 156+1 a10procs.asm
   249                                 [extern glVertex2f]
   250                                 %line 156+0 a10procs.asm
   251                                 [extern glVertex2i]
   252                                 [extern glColor3ub]
   253                                 [extern glOrtho]
   254                                 [extern glFlush]
   255                                 [extern glVertex2d]
   256                                 %line 157+1 a10procs.asm
   257                                 
   258                                 [extern cosf]
   259                                 %line 158+0 a10procs.asm
   260                                 [extern sinf]
   261                                 %line 159+1 a10procs.asm
   262                                 
   263                                 
   264                                 
   265                                 
   266                                 
   267                                 
   268                                 
   269                                 
   270                                 
   271                                 
   272                                 
   273                                 
   274                                 
   275                                 
   276                                 
   277                                 
   278                                 
   279                                 
   280                                 
   281                                 
   282                                 
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 [global getRadii]
   293                                 getRadii:
   294                                 
   295 00000000 55                     push rbp
   296 00000001 4889E5                 mov rbp, rsp
   297 00000004 53                     push rbx
   298 00000005 51                     push rcx
   299 00000006 4153                   push r11
   300 00000008 4154                   push r12
   301 0000000A 4155                   push r13
   302 0000000C 4156                   push r14
   303 0000000E 4157                   push r15
   304                                 
   305 00000010 49C7C401000000         mov r12, 1
   306 00000017 48C7C100000000         mov rcx, 0
   307                                 
   308                                 
   309                                 
   310 0000001E 4E8B3CE6               mov r15, qword [rsi + r12 * 8]
   311 00000022 418A040F               mov al, byte [r15 + rcx]
   312 00000026 3C2D                   cmp al, 45
   313 00000028 753F                   jne incorrectArgs
   314 0000002A 48FFC1                 inc rcx
   315 0000002D 418A040F               mov al, byte [r15 + rcx]
   316 00000031 3C72                   cmp al, 114
   317 00000033 7534                   jne incorrectArgs
   318                                 
   319 00000035 48C7C100000000         mov rcx, 0
   320 0000003C 49FFC4                 inc r12
   321 0000003F 57                     push rdi
   322 00000040 4A8B3CE6               mov rdi, qword [rsi + r12 * 8]
   323 00000044 E895000000             call StringToNum
   324                                 
   325 00000049 4183FE00               cmp r14d, 0
   326 0000004D 7207                   jb r1InvalidValue
   327                                 
   328 0000004F 4181FE1E040000         cmp r14d, 1054
   329 00000056 77FE                   ja r1InvalidValue
   330                                 
   331                                 
   332                                 
   333                                 r1InvalidValue:
   334 00000058 48C7C7[00000000]       mov rdi, errR1value
   335 0000005F E849000000             call printString
   336 00000064 B800000000             mov eax, FALSE
   337 00000069 EB11                   jmp done
   338                                 
   339                                 incorrectArgs:
   340 0000006B 48C7C7[00000000]       mov rdi, errUsage
   341 00000072 E836000000             call printString
   342 00000077 B800000000             mov eax, FALSE
   343 0000007C EBFE                   jmp done
   344                                 
   345                                 done:
   346                                 
   347 0000007E 415E                   pop r14
   348 00000080 415D                   pop r13
   349 00000082 415C                   pop r12
   350 00000084 5D                     pop rbp
   351                                 
   352 00000085 C3                     ret
   353                                 
   354                                 
   355                                 
   356                                 
   357                                 
   358                                 
   359                                 
   360                                 
   361                                 
   362                                 
   363                                 
   364                                 
   365                                 
   366                                 
   367                                 
   368                                 
   369                                 
   370                                 
   371                                 
   372                                 
   373                                 
   374                                 
   375                                 
   376                                 
   377                                 
   378                                 
   379                                 
   380                                 
   381                                 
   382                                 
   383                                 
   384                                 
   385                                 
   386                                 
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 [common radius1 1:4]
   404                                 [common radius2 1:4]
   405                                 [common offPos 1:4]
   406                                 [common speed 1:4]
   407                                 [common color 1:1]
   408                                 
   409                                 [global drawSpiro]
   410                                 drawSpiro:
   411 00000086 4154                    push r12
   412                                 
   413                                 
   414                                 
   415                                 
   416 00000088 48C7C700400000          mov rdi, GL_COLOR_BUFFER_BIT
   417 0000008F E8(F6FFFFFF)            call glClear
   418                                 
   419                                 
   420 00000094 48C7C700000000          mov rdi, GL_POINTS
   421 0000009B E8(F6FFFFFF)            call glBegin
   422                                 
   423                                 
   424                                 
   425                                 
   426                                 
   427                                 
   428                                 
   429                                 
   430                                 
   431                                 
   432                                 
   433                                 
   434                                 
   435                                 
   436                                 
   437                                 
   438                                 
   439                                 
   440                                 
   441                                 
   442                                 
   443                                 
   444 000000A0 E8(F6FFFFFF)            call glEnd
   445 000000A5 E8(F6FFFFFF)            call glFlush
   446                                 
   447                                 
   448                                 
   449                                 
   450                                 
   451                                 
   452                                 
   453                                 
   454                                 
   455                                 
   456 000000AA E8(F6FFFFFF)            call glutPostRedisplay
   457                                 
   458 000000AF 415C                    pop r12
   459 000000B1 C3                      ret
   460                                 
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 
   466                                 
   467                                 
   468                                 
   469                                 
   470                                 
   471                                 
   472                                 
   473                                 
   474                                 [global printString]
   475                                 printString:
   476                                 
   477                                 
   478                                 
   479                                 
   480 000000B2 4889FB                  mov rbx, rdi
   481 000000B5 48C7C200000000          mov rdx, 0
   482                                 strCountLoop:
   483 000000BC 803B00                  cmp byte [rbx], NULL
   484 000000BF 7406                    je strCountDone
   485 000000C1 48FFC3                  inc rbx
   486 000000C4 48FFC2                  inc rdx
   487 000000C7 EBF1                    jmp strCountLoop
   488                                 strCountDone:
   489                                 
   490 000000C9 4883FA00                cmp rdx, 0
   491 000000CD 7411                    je prtDone
   492                                 
   493                                 
   494                                 
   495                                 
   496 000000CF 48C7C001000000          mov rax, SYS_write
   497 000000D6 4889FE                  mov rsi, rdi
   498 000000D9 48C7C701000000          mov rdi, STDOUT
   499                                 
   500 000000E0 0F05                    syscall
   501                                 
   502                                 
   503                                 
   504                                 
   505                                 prtDone:
   506 000000E2 C3                      ret
   507                                 
   508                                 
   509                                 
   510                                 [global StringToNum]
   511                                 StringToNum:
   512                                 
   513 000000E3 51                     push rcx
   514 000000E4 53                     push rbx
   515 000000E5 4155                   push r13
   516 000000E7 4153                   push r11
   517 000000E9 4156                   push r14
   518                                 
   519 000000EB 48C7C100000000         mov rcx, 0
   520                                 
   521                                 stringSize:
   522 000000F2 8A040F                 mov al, byte [rdi + rcx]
   523 000000F5 48FFC1                 inc rcx
   524 000000F8 3C00                   cmp al, NULL
   525 000000FA 75F4                   jne stringSize
   526                                 
   527 000000FC 48FFC9                 dec rcx
   528 000000FF 48C7C300000000         mov rbx, 0
   529 00000106 49C7C50A000000         mov r13, 10
   530 0000010D 4989CB                 mov r11, rcx
   531 00000110 49FFCB                 dec r11
   532 00000113 49C7C600000000         mov r14, 0
   533                                 
   534                                 toDigit:
   535 0000011A 0FB6041F               movzx eax, byte [rdi + rbx]
   536 0000011E 83E830                 sub eax, 48
   537                                 
   538 00000121 4983FB00               cmp r11, 0
   539 00000125 7500                   jne exp
   540 00000127 EB0A                   jmp continue
   541                                 
   542                                 exp:
   543 00000129 41F7E5                 mul r13d
   544 0000012C 49FFCB                 dec r11
   545 0000012F 4983FB00               cmp r11, 0
   546 00000133 75F2                   jne exp
   547                                 
   548                                 continue:
   549 00000135 4101C6                 add r14d, eax
   550                                 
   551 00000138 48FFC3                 inc rbx
   552 0000013B 48FFC9                 dec rcx
   553 0000013E 4989CB                 mov r11, rcx
   554 00000141 49FFCB                 dec r11
   555 00000144 4883F900               cmp rcx, 0
   556 00000148 75CE                   jne toDigit
   557                                 
   558 0000014A 4489F0                 mov eax, r14d
   559                                 
   560 0000014D 415E                   pop r14
   561 0000014F 415B                   pop r11
   562 00000151 415D                   pop r13
   563 00000153 5B                     pop rbx
   564 00000154 59                     pop rcx
   565                                 
   566 00000155 C3                     ret
