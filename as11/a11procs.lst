     1                                 %line 1+1 a11procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 [section .data]
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 LF equ 10
    26                                 NULL equ 0
    27                                 SPACE equ 0x20
    28                                 
    29                                 TRUE equ 1
    30                                 FALSE equ 0
    31                                 
    32                                 SUCCESS equ 0
    33                                 NOSUCCESS equ 1
    34                                 
    35                                 STDIN equ 0
    36                                 STDOUT equ 1
    37                                 STDERR equ 2
    38                                 
    39                                 SYS_read equ 0
    40                                 SYS_write equ 1
    41                                 SYS_open equ 2
    42                                 SYS_close equ 3
    43                                 SYS_fork equ 57
    44                                 SYS_exit equ 60
    45                                 SYS_creat equ 85
    46                                 SYS_time equ 201
    47                                 
    48                                 O_CREAT equ 0x40
    49                                 O_TRUNC equ 0x200
    50                                 O_APPEND equ 0x400
    51                                 
    52                                 O_RDONLY equ 000000
    53                                 O_WRONLY equ 000001
    54                                 O_RDWR equ 000002
    55                                 
    56                                 S_IRUSR equ 00400
    57                                 S_IWUSR equ 00200
    58                                 S_IXUSR equ 00100
    59                                 
    60                                 
    61                                 
    62                                 
    63                                 GRAYSCALE equ 0
    64                                 BRIGHTEN equ 1
    65                                 DARKEN equ 2
    66                                 
    67                                 MIN_FILE_LEN equ 5
    68                                 BUFF_SIZE equ 1000000
    69                                 
    70                                 
    71                                 
    72                                 
    73 00000000 00                     eof db FALSE
    74                                 
    75 00000001 55736167653A202E2F-    usageMsg db "Usage: ./imageCvt <-gr|-br|-dk> <inputFile.bmp> "
    76 00000001 696D61676543767420-
    77 00000001 3C2D67727C2D62727C-
    78 00000001 2D646B3E203C696E70-
    79 00000001 757446696C652E626D-
    80 00000001 703E20             
    81 00000031 3C6F75747075744669-     db "<outputFile.bmp>", LF, NULL
    82 00000031 6C652E626D703E0A00 
    83 00000043 4572726F722C20696E-    errIncomplete db "Error, incomplete command line arguments.", LF, NULL
    84 00000043 636F6D706C65746520-
    85 00000043 636F6D6D616E64206C-
    86 00000043 696E6520617267756D-
    87 00000043 656E74732E0A00     
    88 0000006E 4572726F722C20746F-    errExtra db "Error, too many command line arguments.", LF, NULL
    89 0000006E 6F206D616E7920636F-
    90 0000006E 6D6D616E64206C696E-
    91 0000006E 6520617267756D656E-
    92 0000006E 74732E0A00         
    93 00000097 4572726F722C20696E-    errOption db "Error, invalid image processing option.", LF, NULL
    94 00000097 76616C696420696D61-
    95 00000097 67652070726F636573-
    96 00000097 73696E67206F707469-
    97 00000097 6F6E2E0A00         
    98 000000C0 4572726F722C20696E-    errReadName db "Error, invalid source file name.  Must be '.bmp' file.", LF, NULL
    99 000000C0 76616C696420736F75-
   100 000000C0 7263652066696C6520-
   101 000000C0 6E616D652E20204D75-
   102 000000C0 737420626520272E62-
   103 000000C0 6D70272066696C652E-
   104 000000C0 0A00               
   105 000000F8 4572726F722C20696E-    errWriteName db "Error, invalid output file name.  Must be '.bmp' file.", LF, NULL
   106 000000F8 76616C6964206F7574-
   107 000000F8 7075742066696C6520-
   108 000000F8 6E616D652E20204D75-
   109 000000F8 737420626520272E62-
   110 000000F8 6D70272066696C652E-
   111 000000F8 0A00               
   112 00000130 4572726F722C20756E-    errReadFile db "Error, unable to open input file.", LF, NULL
   113 00000130 61626C6520746F206F-
   114 00000130 70656E20696E707574-
   115 00000130 2066696C652E0A00   
   116 00000153 4572726F722C20756E-    errWriteFile db "Error, unable to open output file.", LF, NULL
   117 00000153 61626C6520746F206F-
   118 00000153 70656E206F75747075-
   119 00000153 742066696C652E0A00 
   120                                 
   121                                 
   122                                 
   123                                 
   124                                 HEADER_SIZE equ 54
   125                                 
   126 00000177 4572726F722C20756E-    errReadHdr db "Error, unable to read header from source image file."
   127 00000177 61626C6520746F2072-
   128 00000177 656164206865616465-
   129 00000177 722066726F6D20736F-
   130 00000177 7572636520696D6167-
   131 00000177 652066696C652E     
   132 000001AB 0A00                    db LF, NULL
   133 000001AD 4572726F722C20696E-    errFileType db "Error, invalid file signature.", LF, NULL
   134 000001AD 76616C69642066696C-
   135 000001AD 65207369676E617475-
   136 000001AD 72652E0A00         
   137 000001CD 4572726F722C20756E-    errDepth db "Error, unsupported color depth.  Must be 24-bit color."
   138 000001CD 737570706F72746564-
   139 000001CD 20636F6C6F72206465-
   140 000001CD 7074682E20204D7573-
   141 000001CD 742062652032342D62-
   142 000001CD 697420636F6C6F722E 
   143 00000203 0A00                    db LF, NULL
   144 00000205 4572726F722C206F6E-    errCompType db "Error, only non-compressed images are supported."
   145 00000205 6C79206E6F6E2D636F-
   146 00000205 6D7072657373656420-
   147 00000205 696D61676573206172-
   148 00000205 6520737570706F7274-
   149 00000205 65642E             
   150 00000235 0A00                    db LF, NULL
   151 00000237 4572726F722C206269-    errSize db "Error, bitmap block size inconsistent.", LF, NULL
   152 00000237 746D617020626C6F63-
   153 00000237 6B2073697A6520696E-
   154 00000237 636F6E73697374656E-
   155 00000237 742E0A00           
   156 0000025F 4572726F722C20756E-    errWriteHdr db "Error, unable to write header to output image file.", LF,
   157 0000025F 61626C6520746F2077-
   158 0000025F 726974652068656164-
   159 0000025F 657220746F206F7574-
   160 0000025F 70757420696D616765-
   161 0000025F 2066696C652E0A     
   162 00000293 50726F6772616D2074-     db "Program terminated.", LF, NULL
   163 00000293 65726D696E61746564-
   164 00000293 2E0A00             
   165                                 
   166                                 
   167                                 
   168                                 
   169 000002A8 40420F0000000000       buffMax dq BUFF_SIZE
   170 000002B0 40420F0000000000       curr dq BUFF_SIZE
   171 000002B8 00                     wasEOF db FALSE
   172 000002B9 0000000000000000       pixelCount dq 0
   173                                 
   174 000002C1 4572726F722C207265-    errRead db "Error, reading from source image file.", LF,
   175 000002C1 6164696E672066726F-
   176 000002C1 6D20736F7572636520-
   177 000002C1 696D6167652066696C-
   178 000002C1 652E0A             
   179 000002E8 50726F6772616D2074-     db "Program terminated.", LF, NULL
   180 000002E8 65726D696E61746564-
   181 000002E8 2E0A00             
   182                                 
   183                                 
   184                                 
   185                                 
   186 000002FD 4572726F722C207772-    errWrite db "Error, writting to output image file.", LF,
   187 000002FD 697474696E6720746F-
   188 000002FD 206F75747075742069-
   189 000002FD 6D6167652066696C65-
   190 000002FD 2E0A               
   191 00000323 50726F6772616D2074-     db "Program terminated.", LF, NULL
   192 00000323 65726D696E61746564-
   193 00000323 2E0A00             
   194                                 
   195                                 
   196                                 
   197                                 
   198                                 
   199                                 [section .bss]
   200                                 
   201 00000000 <gap>                  localBuffer resb BUFF_SIZE
   202 000F4240 <gap>                  header resb HEADER_SIZE
   203                                 
   204                                 
   205                                 
   206                                 
   207                                 [section .text]
   208                                 
   209                                 
   210                                 
   211                                 
   212                                 
   213                                 
   214                                 
   215                                 
   216                                 
   217                                 
   218                                 
   219                                 
   220                                 
   221                                 
   222                                 
   223                                 
   224                                 
   225                                 
   226                                 
   227                                 
   228                                 
   229                                 
   230                                 
   231                                 
   232                                 
   233                                 [global getArguments]
   234                                 getArguments:
   235                                 
   236 00000000 55                     push rbp
   237 00000001 4889E5                 mov rbp, rsp
   238 00000004 4152                   push r10
   239 00000006 4153                   push r11
   240 00000008 4154                   push r12
   241 0000000A 4155                   push r13
   242 0000000C 4157                   push r15
   243                                 
   244                                 
   245                                 
   246                                 
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 
   252                                 
   253 0000000E 49C7C201000000         mov r10, 1
   254 00000015 49C7C300000000         mov r11, 0
   255 0000001C 4989CC                 mov r12, rcx
   256 0000001F 4D89C5                 mov r13, r8
   257                                 
   258                                 
   259 00000022 4E8B3CD6               mov r15, qword [rsi + r10 * 8]
   260 00000026 438A041F               mov al, byte [r15 + r11]
   261 0000002A 3C2D                   cmp al, 45
   262 0000002C 0F85F5000000           jne imInvalid
   263 00000032 49FFC3                 inc r11
   264 00000035 438A041F               mov al, byte [r15 + r11]
   265 00000039 3C67                   cmp al, 103
   266 0000003B 7506                   jne checkB
   267 0000003D C70200000000           mov dword [rdx], GRAYSCALE
   268 00000043 EB2E                   jmp checkSecondInput
   269                                 checkB:
   270 00000045 3C62                   cmp al, 98
   271 00000047 7511                   jne checkD
   272 00000049 49FFC3                 inc r11
   273 0000004C 3C72                   cmp al, 114
   274 0000004E 0F85D3000000           jne imInvalid
   275 00000054 C70201000000           mov dword [rdx], BRIGHTEN
   276 0000005A EB17                   jmp checkSecondInput
   277                                 checkD:
   278 0000005C 3C64                   cmp al, 100
   279 0000005E 0F85C3000000           jne imInvalid
   280 00000064 49FFC3                 inc r11
   281 00000067 3C6B                   cmp al, 107
   282 00000069 0F85B8000000           jne imInvalid
   283 0000006F C70202000000           mov dword [rdx], DARKEN
   284                                 
   285                                 checkSecondInput:
   286 00000075 49FFC2                 inc r10
   287 00000078 49C7C300000000         mov r11, 0
   288 0000007F 57                     push rdi
   289 00000080 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   290 00000084 E8E0040000             call checkFileExtension
   291 00000089 5F                     pop rdi
   292 0000008A 4883F801               cmp rax, TRUE
   293 0000008E 7575                   jne invalidReadFileName
   294 00000090 57                     push rdi
   295 00000091 56                     push rsi
   296 00000092 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   297 00000096 E81A050000             call openFile
   298 0000009B 5E                     pop rsi
   299 0000009C 5F                     pop rdi
   300 0000009D 4883F800               cmp rax, 0
   301 000000A1 7C75                   jl openFileError
   302 000000A3 49890424               mov qword [r12], rax
   303 000000A7 49FFC2                 inc r10
   304 000000AA 57                     push rdi
   305 000000AB 56                     push rsi
   306 000000AC 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   307 000000B0 E8B4040000             call checkFileExtension
   308 000000B5 5E                     pop rsi
   309 000000B6 5F                     pop rdi
   310 000000B7 4883F801               cmp rax, TRUE
   311 000000BB 7535                   jne invalidWriteFileName
   312 000000BD 57                     push rdi
   313 000000BE 56                     push rsi
   314 000000BF 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   315 000000C3 E808050000             call createFile
   316 000000C8 5E                     pop rsi
   317 000000C9 5F                     pop rdi
   318 000000CA 4883F800               cmp rax, 0
   319 000000CE 7C0C                   jl createFileError
   320 000000D0 49894500               mov qword [r13], rax
   321                                 
   322 000000D4 B801000000             mov eax, TRUE
   323                                 
   324 000000D9 E996000000             jmp done
   325                                 createFileError:
   326 000000DE 48C7C7[00000000]       mov rdi, errWriteFile
   327 000000E5 E84C040000             call printString
   328 000000EA B800000000             mov eax, FALSE
   329 000000EF E980000000             jmp done
   330                                 
   331                                 invalidWriteFileName:
   332 000000F4 48C7C7[00000000]       mov rdi, errWriteName
   333 000000FB E836040000             call printString
   334 00000100 B800000000             mov eax, FALSE
   335 00000105 EB70                   jmp done
   336                                 
   337                                 invalidReadFileName:
   338 00000107 48C7C7[00000000]       mov rdi, errReadName
   339 0000010E E823040000             call printString
   340 00000113 B800000000             mov eax, FALSE
   341 00000118 EB5D                   jmp done
   342                                 
   343                                 openFileError:
   344 0000011A 48C7C7[00000000]       mov rdi, errReadFile
   345 00000121 E810040000             call printString
   346 00000126 B800000000             mov eax, FALSE
   347 0000012B EB4A                   jmp done
   348                                 
   349                                 imInvalid:
   350 0000012D 48C7C7[00000000]       mov rdi, errOption
   351 00000134 E8FD030000             call printString
   352 00000139 B800000000             mov eax, FALSE
   353 0000013E EB37                   jmp done
   354                                 
   355                                 incorrectUsage:
   356 00000140 48C7C7[00000000]       mov rdi, usageMsg
   357 00000147 E8EA030000             call printString
   358 0000014C B800000000             mov eax, FALSE
   359 00000151 EB24                   jmp done
   360                                 
   361                                 tooFewArgs:
   362 00000153 48C7C7[00000000]       mov rdi, errIncomplete
   363 0000015A E8D7030000             call printString
   364 0000015F B800000000             mov eax, FALSE
   365 00000164 EB11                   jmp done
   366                                 
   367                                 tooManyArgs:
   368 00000166 48C7C7[00000000]       mov rdi, errExtra
   369 0000016D E8C4030000             call printString
   370 00000172 B800000000             mov eax, FALSE
   371 00000177 EBFE                   jmp done
   372                                 
   373                                 done:
   374 00000179 415F                   pop r15
   375 0000017B 415D                   pop r13
   376 0000017D 415C                   pop r12
   377 0000017F 415B                   pop r11
   378 00000181 415A                   pop r10
   379 00000183 5D                     pop rbp
   380                                 
   381 00000184 C3                     ret
   382                                 
   383                                 
   384                                 
   385                                 
   386                                 
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 
   404                                 
   405                                 
   406                                 
   407                                 
   408                                 
   409                                 
   410                                 
   411                                 
   412                                 
   413                                 
   414                                 
   415                                 
   416                                 
   417                                 
   418                                 
   419                                 [global processHeaders]
   420                                 processHeaders:
   421                                 
   422 00000185 53                     push rbx
   423 00000186 4151                   push r9
   424 00000188 4152                   push r10
   425 0000018A 4153                   push r11
   426 0000018C 4154                   push r12
   427 0000018E 4155                   push r13
   428 00000190 4156                   push r14
   429 00000192 4157                   push r15
   430                                 
   431 00000194 4889FB                 mov rbx, rdi
   432 00000197 4989F1                 mov r9, rsi
   433 0000019A 49C7C200000000         mov r10, 0
   434 000001A1 4989CC                 mov r12, rcx
   435 000001A4 4D89C5                 mov r13, r8
   436 000001A7 4989D7                 mov r15, rdx
   437                                 
   438 000001AA 48C7C000000000         mov rax, SYS_read
   439 000001B1 4889DF                 mov rdi, rbx
   440 000001B4 48C7C6[00000000]       mov rsi, header
   441 000001BB 48C7C236000000         mov rdx, HEADER_SIZE
   442 000001C2 0F05                   syscall
   443 000001C4 4883F800               cmp rax, 0
   444 000001C8 0F8C4D010000           jl errorOnRead
   445                                 
   446                                 
   447 000001CE 418A82[00000000]       mov al, byte [header + r10]
   448 000001D5 3C42                   cmp al, 66
   449 000001D7 0F852B010000           jne fileTypeError
   450 000001DD 49FFC2                 inc r10
   451 000001E0 418A82[00000000]       mov al, byte [header + r10]
   452 000001E7 3C4D                   cmp al, 77
   453 000001E9 0F8519010000           jne fileTypeError
   454 000001EF 49FFC2                 inc r10
   455 000001F2 418B82[00000000]       mov eax, dword [header + r10]
   456 000001F9 418907                 mov dword [r15], eax
   457 000001FC 4983C208               add r10, 8
   458 00000200 418B82[00000000]       mov eax, dword [header + r10]
   459 00000207 83F836                 cmp eax, 54
   460 0000020A 0F85BF000000           jne invalidBitmapSize
   461 00000210 4189C6                 mov r14d, eax
   462 00000213 4983C204               add r10, 4
   463 00000217 418B82[00000000]       mov eax, dword [header + r10]
   464 0000021E 4983C204               add r10, 4
   465 00000222 418B82[00000000]       mov eax, dword [header + r10]
   466 00000229 41890424               mov dword [r12], eax
   467 0000022D 50                     push rax
   468 0000022E 4152                   push r10
   469 00000230 41BA03000000           mov r10d, 3
   470 00000236 41F7E2                 mul r10d
   471 00000239 4C891425[00000000]     mov qword [pixelCount], r10
   472 00000241 415A                   pop r10
   473 00000243 58                     pop rax
   474 00000244 4983C204               add r10, 4
   475 00000248 418B82[00000000]       mov eax, dword [header + r10]
   476 0000024F 41894500               mov dword [r13], eax
   477 00000253 4983C204               add r10, 4
   478 00000257 66418B82[00000000]     mov ax, word [header + r10]
   479 0000025F 4983C202               add r10, 2
   480 00000263 66418B82[00000000]     mov ax, word [header + r10]
   481 0000026B 6683F818               cmp ax, 24
   482 0000026F 0F8580000000           jne depthError
   483 00000275 4983C202               add r10, 2
   484 00000279 418B82[00000000]       mov eax, dword [header + r10]
   485 00000280 83F800                 cmp eax, 0
   486 00000283 7561                   jne compTypeError
   487 00000285 4983C204               add r10, 4
   488 00000289 418B82[00000000]       mov eax, dword [header + r10]
   489 00000290 4401F0                 add eax, r14d
   490 00000293 458B1F                 mov r11d, dword [r15]
   491 00000296 413907                 cmp dword [r15], eax
   492 00000299 7538                   jne invalidBitmapSize
   493                                 
   494                                 
   495 0000029B 48C7C001000000         mov rax, SYS_write
   496 000002A2 4C89CF                 mov rdi, r9
   497 000002A5 48C7C6[00000000]       mov rsi, header
   498 000002AC 48C7C236000000         mov rdx, HEADER_SIZE
   499 000002B3 0F05                   syscall
   500 000002B5 4883F800               cmp rax, 0
   501 000002B9 7C05                   jl errorToWrite
   502                                 
   503 000002BB B801000000             mov eax, TRUE
   504 000002C0 EB70                   jmp done1
   505                                 
   506                                 errorToWrite:
   507 000002C2 48C7C7[00000000]       mov rdi, errWriteFile
   508 000002C9 E868020000             call printString
   509 000002CE B800000000             mov eax, FALSE
   510 000002D3 EB5D                   jmp done1
   511                                 
   512                                 invalidBitmapSize:
   513 000002D5 48C7C7[00000000]       mov rdi, errSize
   514 000002DC E855020000             call printString
   515 000002E1 B800000000             mov eax, FALSE
   516 000002E6 EB4A                   jmp done1
   517                                 
   518                                 compTypeError:
   519 000002E8 48C7C7[00000000]       mov rdi, errCompType
   520 000002EF E842020000             call printString
   521 000002F4 B800000000             mov eax, FALSE
   522 000002F9 EB37                   jmp done1
   523                                 
   524                                 depthError:
   525 000002FB 48C7C7[00000000]       mov rdi, errDepth
   526 00000302 E82F020000             call printString
   527 00000307 B800000000             mov eax, FALSE
   528 0000030C EB24                   jmp done1
   529                                 
   530                                 fileTypeError:
   531 0000030E 48C7C7[00000000]       mov rdi, errFileType
   532 00000315 E81C020000             call printString
   533 0000031A B800000000             mov eax, FALSE
   534 0000031F EB11                   jmp done1
   535                                 
   536                                 errorOnRead:
   537 00000321 48C7C7[00000000]       mov rdi, errReadHdr
   538 00000328 E809020000             call printString
   539 0000032D B800000000             mov eax, FALSE
   540 00000332 EBFE                   jmp done1
   541                                 
   542                                 done1:
   543 00000334 415F                   pop r15
   544 00000336 415E                   pop r14
   545 00000338 415D                   pop r13
   546 0000033A 415C                   pop r12
   547 0000033C 415B                   pop r11
   548 0000033E 415A                   pop r10
   549 00000340 4159                   pop r9
   550 00000342 5B                     pop rbx
   551                                 
   552 00000343 C3                     ret
   553                                 
   554                                 
   555                                 
   556                                 
   557                                 
   558                                 
   559                                 
   560                                 
   561                                 
   562                                 
   563                                 
   564                                 
   565                                 
   566                                 
   567                                 
   568                                 
   569                                 
   570                                 
   571                                 
   572                                 
   573                                 
   574                                 
   575                                 
   576                                 
   577                                 
   578                                 
   579                                 
   580                                 
   581                                 [global getRow]
   582                                 getRow:
   583                                 
   584 00000344 53                     push rbx
   585 00000345 4152                   push r10
   586 00000347 4153                   push r11
   587 00000349 4156                   push r14
   588 0000034B 4157                   push r15
   589                                 
   590 0000034D 4889FB                 mov rbx, rdi
   591 00000350 4889F0                 mov rax, rsi
   592 00000353 4989D7                 mov r15, rdx
   593 00000356 49C7C203000000         mov r10, 3
   594 0000035D 49F7E2                 mul r10
   595 00000360 4989C2                 mov r10, rax
   596 00000363 4C8B3425[00000000]     mov r14, qword [buffMax]
   597                                 
   598 0000036B 803C25[00000000]01     cmp byte [wasEOF], TRUE
   599 00000373 0F8499000000           je doNotRead
   600 00000379 4C393425[00000000]     cmp qword [curr], r14
   601 00000381 7237                   jb getNextChr
   602                                 
   603                                 readFromFile:
   604 00000383 48C7C000000000         mov rax, SYS_read
   605 0000038A 4889DF                 mov rdi, rbx
   606 0000038D 48C7C6[00000000]       mov rsi, localBuffer
   607 00000394 48C7C240420F00         mov rdx, BUFF_SIZE
   608 0000039B 0F05                   syscall
   609 0000039D 4883F800               cmp rax, 0
   610 000003A1 7C7A                   jl readError
   611 000003A3 4C39D0                 cmp rax, r10
   612 000003A6 7C57                   jl endOfFile
   613 000003A8 48890425[00000000]     mov qword [buffMax], rax
   614 000003B0 48C70425[00000000]-    mov qword [curr], 0
   615 000003B0 00000000           
   616                                 getNextChr:
   617 000003BC 4C8B1C25[00000000]     mov r11, qword [curr]
   618 000003C4 49C7C600000000         mov r14, 0
   619 000003CB 48C7C000000000         mov rax, 0
   620                                 moveToRow:
   621 000003D2 418A83[00000000]       mov al, byte [localBuffer + r11]
   622 000003D9 43880437               mov byte [r15 + r14], al
   623 000003DD 49FFC3                 inc r11
   624 000003E0 49FFC6                 inc r14
   625 000003E3 4C891C25[00000000]     mov qword [curr], r11
   626 000003EB 4C3B1C25[00000000]     cmp r11, qword [buffMax]
   627 000003F3 748C                   je readFromFile
   628 000003F5 4D39D6                 cmp r14, r10
   629 000003F8 72D6                   jb moveToRow
   630                                 
   631 000003FA B801000000             mov eax, TRUE
   632 000003FF EB2F                   jmp done2
   633                                 
   634                                 endOfFile:
   635 00000401 48890425[00000000]     mov qword [buffMax], rax
   636 00000409 B800000000             mov eax, FALSE
   637 0000040E C60425[00000000]01     mov byte [wasEOF], TRUE
   638 00000416 EB18                   jmp done2
   639                                 
   640                                 doNotRead:
   641 00000418 B800000000             mov eax, FALSE
   642 0000041D EB11                   jmp done2
   643                                 
   644                                 readError:
   645 0000041F 48C7C7[00000000]       mov rdi, errReadFile
   646 00000426 E80B010000             call printString
   647 0000042B B800000000             mov eax, FALSE
   648 00000430 EBFE                   jmp done2
   649                                 
   650                                 done2:
   651 00000432 415F                   pop r15
   652 00000434 415E                   pop r14
   653 00000436 415B                   pop r11
   654 00000438 415A                   pop r10
   655 0000043A 5B                     pop rbx
   656                                 
   657 0000043B C3                     ret
   658                                 
   659                                 
   660                                 
   661                                 
   662                                 
   663                                 
   664                                 
   665                                 
   666                                 
   667                                 
   668                                 
   669                                 
   670                                 
   671                                 
   672                                 
   673                                 
   674                                 
   675                                 
   676                                 
   677                                 
   678                                 
   679                                 
   680                                 
   681                                 
   682                                 
   683                                 
   684                                 [global writeRow]
   685                                 writeRow:
   686                                 
   687 0000043C 53                     push rbx
   688 0000043D 4152                   push r10
   689 0000043F 4153                   push r11
   690                                 
   691 00000441 4889D3                 mov rbx, rdx
   692 00000444 4989FA                 mov r10, rdi
   693 00000447 4889F0                 mov rax, rsi
   694 0000044A 49C7C303000000         mov r11, 3
   695 00000451 52                     push rdx
   696 00000452 49F7E3                 mul r11
   697 00000455 5A                     pop rdx
   698 00000456 4989C3                 mov r11, rax
   699                                 
   700 00000459 803C25[00000000]01     cmp byte [wasEOF], TRUE
   701 00000461 7506                   jne writeToFile
   702 00000463 4C8B1C25[00000000]     mov r11, qword [buffMax]
   703                                 writeToFile:
   704 0000046B 48C7C001000000         mov rax, SYS_write
   705 00000472 4C89D7                 mov rdi, r10
   706 00000475 4889DE                 mov rsi, rbx
   707 00000478 4C89DA                 mov rdx, r11
   708 0000047B 0F05                   syscall
   709 0000047D 4883F800               cmp rax, 0
   710 00000481 7C05                   jl errorOnWrite
   711                                 
   712 00000483 B801000000             mov eax, TRUE
   713 00000488 EB11                   jmp done3
   714                                 
   715                                 errorOnWrite:
   716 0000048A 48C7C7[00000000]       mov rdi, errWrite
   717 00000491 E8A0000000             call printString
   718 00000496 B800000000             mov eax, FALSE
   719 0000049B EBFE                   jmp done3
   720                                 
   721                                 done3:
   722 0000049D 415B                   pop r11
   723 0000049F 415A                   pop r10
   724 000004A1 5B                     pop rbx
   725                                 
   726 000004A2 C3                     ret
   727                                 
   728                                 
   729                                 
   730                                 
   731                                 
   732                                 
   733                                 
   734                                 
   735                                 
   736                                 
   737                                 
   738                                 
   739                                 
   740                                 
   741                                 
   742                                 
   743                                 
   744                                 [global imageCvtToBW]
   745                                 imageCvtToBW:
   746                                 
   747 000004A3 53                     push rbx
   748 000004A4 4152                   push r10
   749 000004A6 4154                   push r12
   750 000004A8 4155                   push r13
   751 000004AA 4156                   push r14
   752 000004AC 4157                   push r15
   753                                 
   754 000004AE 4889F8                 mov rax, rdi
   755 000004B1 49C7C203000000         mov r10, 3
   756 000004B8 49F7E2                 mul r10
   757 000004BB 4889C3                 mov rbx, rax
   758 000004BE 4989F2                 mov r10, rsi
   759 000004C1 49C7C400000000         mov r12, 0
   760 000004C8 49C7C500000000         mov r13, 0
   761 000004CF 48C7C000000000         mov rax, 0
   762 000004D6 49C7C700000000         mov r15, 0
   763 000004DD 49C7C603000000         mov r14, 3
   764                                 
   765                                 cvtToBw:
   766 000004E4 478A2C22               mov r13b, byte [r10 + r12]
   767 000004E8 4401E8                 add eax, r13d
   768 000004EB 49FFC7                 inc r15
   769 000004EE 49FFC4                 inc r12
   770 000004F1 4983FF03               cmp r15, 3
   771 000004F5 7403                   je cvtColor
   772 000004F7 4939DC                 cmp r12, rbx
   773 000004FA 72E6                   jb cvtToBw
   774                                 
   775                                 cvtColor:
   776 000004FC 6641F7F6               div r14w
   777 00000500 4154                   push r12
   778 00000502 4983EC03               sub r12, 3
   779 00000506 43880422               mov byte [r10 + r12], al
   780 0000050A 49FFC4                 inc r12
   781 0000050D 43880422               mov byte [r10 + r12], al
   782 00000511 49FFC4                 inc r12
   783 00000514 43880422               mov byte [r10 + r12], al
   784 00000518 49C7C700000000         mov r15, 0
   785 0000051F 48C7C000000000         mov rax, 0
   786 00000526 415C                   pop r12
   787 00000528 4939DC                 cmp r12, rbx
   788 0000052B 72B5                   jb cvtToBw
   789                                 
   790 0000052D 415F                   pop r15
   791 0000052F 415E                   pop r14
   792 00000531 415D                   pop r13
   793 00000533 415C                   pop r12
   794 00000535 415A                   pop r10
   795 00000537 5B                     pop rbx
   796                                 
   797                                 
   798 00000538 C3                     ret
   799                                 
   800                                 
   801                                 
   802                                 
   803                                 
   804                                 
   805                                 
   806                                 
   807                                 
   808                                 
   809                                 
   810                                 
   811                                 
   812                                 
   813                                 
   814                                 
   815                                 
   816                                 [global imageBrighten]
   817                                 imageBrighten:
   818                                 
   819 00000539 C3                     ret
   820                                 
   821                                 
   822                                 
   823                                 
   824                                 
   825                                 
   826                                 
   827                                 
   828                                 
   829                                 
   830                                 
   831                                 
   832                                 
   833                                 
   834                                 
   835                                 
   836                                 
   837                                 [global imageDarken]
   838                                 imageDarken:
   839                                 
   840 0000053A C3                     ret
   841                                 
   842                                 
   843                                 
   844                                 
   845                                 
   846                                 
   847                                 
   848                                 
   849                                 
   850                                 
   851                                 
   852                                 
   853                                 
   854                                 
   855                                 
   856                                 [global printString]
   857                                 printString:
   858 0000053B 53                      push rbx
   859                                 
   860                                 
   861                                 
   862                                 
   863 0000053C 4889FB                  mov rbx, rdi
   864 0000053F 48C7C200000000          mov rdx, 0
   865                                 strCountLoop:
   866 00000546 803B00                  cmp byte [rbx], NULL
   867 00000549 7406                    je strCountDone
   868 0000054B 48FFC3                  inc rbx
   869 0000054E 48FFC2                  inc rdx
   870 00000551 EBF1                    jmp strCountLoop
   871                                 strCountDone:
   872                                 
   873 00000553 4883FA00                cmp rdx, 0
   874 00000557 7411                    je prtDone
   875                                 
   876                                 
   877                                 
   878                                 
   879 00000559 48C7C001000000          mov rax, SYS_write
   880 00000560 4889FE                  mov rsi, rdi
   881 00000563 48C7C701000000          mov rdi, STDOUT
   882                                 
   883 0000056A 0F05                    syscall
   884                                 
   885                                 
   886                                 
   887                                 
   888                                 prtDone:
   889 0000056C 5B                      pop rbx
   890 0000056D C3                      ret
   891                                 
   892                                 
   893                                 
   894                                 
   895                                 
   896                                 
   897                                 [global checkFileExtension]
   898                                 checkFileExtension:
   899                                 
   900 0000056E 4152                   push r10
   901                                 
   902 00000570 49C7C200000000         mov r10, 0
   903                                 searchExt:
   904 00000577 428A0417               mov al, byte [rdi + r10]
   905 0000057B 49FFC2                 inc r10
   906 0000057E 3C2E                   cmp al, 46
   907 00000580 75F3                   jne searchExt
   908 00000582 428A0417               mov al, byte [rdi + r10]
   909 00000586 3C62                   cmp al, 98
   910 00000588 7526                   jne invalidFileExtension
   911 0000058A 49FFC2                 inc r10
   912 0000058D 428A0417               mov al, byte [rdi + r10]
   913 00000591 3C6D                   cmp al, 109
   914 00000593 751B                   jne invalidFileExtension
   915 00000595 49FFC2                 inc r10
   916 00000598 428A0417               mov al, byte [rdi + r10]
   917 0000059C 3C70                   cmp al, 112
   918 0000059E 7510                   jne invalidFileExtension
   919 000005A0 49FFC2                 inc r10
   920 000005A3 428A0417               mov al, byte [rdi + r10]
   921 000005A7 3C00                   cmp al, NULL
   922 000005A9 7505                   jne invalidFileExtension
   923                                 
   924 000005AB B801000000             mov eax, TRUE
   925 000005B0 EB03                   jmp extensionReturn
   926                                 
   927                                 invalidFileExtension:
   928 000005B2 B800000000             mov eax, FALSE
   929                                 
   930                                 extensionReturn:
   931 000005B7 415A                   pop r10
   932                                 
   933 000005B9 C3                     ret
   934                                 
   935                                 
   936                                 
   937                                 [global openFile]
   938                                 openFile:
   939                                 
   940 000005BA 4152                   push r10
   941                                 
   942 000005BC 4C8D17                 lea r10, qword [rdi]
   943                                 
   944 000005BF 48C7C002000000         mov rax, SYS_open
   945 000005C6 4C89D7                 mov rdi, r10
   946 000005C9 48C7C600000000         mov rsi, O_RDONLY
   947 000005D0 0F05                   syscall
   948                                 
   949 000005D2 415A                   pop r10
   950                                 
   951 000005D4 C3                     ret
   952                                 
   953                                 
   954                                 
   955                                 [global createFile]
   956                                 createFile:
   957                                 
   958 000005D5 4152                   push r10
   959                                 
   960 000005D7 4C8D17                 lea r10, qword [rdi]
   961                                 
   962 000005DA 48C7C055000000         mov rax, SYS_creat
   963 000005E1 4C89D7                 mov rdi, r10
   964 000005E4 48C7C680010000         mov rsi, S_IRUSR | S_IWUSR
   965 000005EB 0F05                   syscall
   966                                 
   967 000005ED 415A                   pop r10
   968                                 
   969 000005EF C3                     ret
