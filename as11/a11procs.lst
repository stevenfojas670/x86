     1                                 %line 1+1 a11procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 [section .data]
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 LF equ 10
    26                                 NULL equ 0
    27                                 SPACE equ 0x20
    28                                 
    29                                 TRUE equ 1
    30                                 FALSE equ 0
    31                                 
    32                                 SUCCESS equ 0
    33                                 NOSUCCESS equ 1
    34                                 
    35                                 STDIN equ 0
    36                                 STDOUT equ 1
    37                                 STDERR equ 2
    38                                 
    39                                 SYS_read equ 0
    40                                 SYS_write equ 1
    41                                 SYS_open equ 2
    42                                 SYS_close equ 3
    43                                 SYS_fork equ 57
    44                                 SYS_exit equ 60
    45                                 SYS_creat equ 85
    46                                 SYS_time equ 201
    47                                 
    48                                 O_CREAT equ 0x40
    49                                 O_TRUNC equ 0x200
    50                                 O_APPEND equ 0x400
    51                                 
    52                                 O_RDONLY equ 000000
    53                                 O_WRONLY equ 000001
    54                                 O_RDWR equ 000002
    55                                 
    56                                 S_IRUSR equ 00400
    57                                 S_IWUSR equ 00200
    58                                 S_IXUSR equ 00100
    59                                 
    60                                 
    61                                 
    62                                 
    63                                 GRAYSCALE equ 0
    64                                 BRIGHTEN equ 1
    65                                 DARKEN equ 2
    66                                 
    67                                 MIN_FILE_LEN equ 5
    68                                 BUFF_SIZE equ 1000000
    69                                 
    70                                 
    71                                 
    72                                 
    73 00000000 00                     eof db FALSE
    74                                 
    75 00000001 55736167653A202E2F-    usageMsg db "Usage: ./imageCvt <-gr|-br|-dk> <inputFile.bmp> "
    76 00000001 696D61676543767420-
    77 00000001 3C2D67727C2D62727C-
    78 00000001 2D646B3E203C696E70-
    79 00000001 757446696C652E626D-
    80 00000001 703E20             
    81 00000031 3C6F75747075744669-     db "<outputFile.bmp>", LF, NULL
    82 00000031 6C652E626D703E0A00 
    83 00000043 4572726F722C20696E-    errIncomplete db "Error, incomplete command line arguments.", LF, NULL
    84 00000043 636F6D706C65746520-
    85 00000043 636F6D6D616E64206C-
    86 00000043 696E6520617267756D-
    87 00000043 656E74732E0A00     
    88 0000006E 4572726F722C20746F-    errExtra db "Error, too many command line arguments.", LF, NULL
    89 0000006E 6F206D616E7920636F-
    90 0000006E 6D6D616E64206C696E-
    91 0000006E 6520617267756D656E-
    92 0000006E 74732E0A00         
    93 00000097 4572726F722C20696E-    errOption db "Error, invalid image processing option.", LF, NULL
    94 00000097 76616C696420696D61-
    95 00000097 67652070726F636573-
    96 00000097 73696E67206F707469-
    97 00000097 6F6E2E0A00         
    98 000000C0 4572726F722C20696E-    errReadName db "Error, invalid source file name.  Must be '.bmp' file.", LF, NULL
    99 000000C0 76616C696420736F75-
   100 000000C0 7263652066696C6520-
   101 000000C0 6E616D652E20204D75-
   102 000000C0 737420626520272E62-
   103 000000C0 6D70272066696C652E-
   104 000000C0 0A00               
   105 000000F8 4572726F722C20696E-    errWriteName db "Error, invalid output file name.  Must be '.bmp' file.", LF, NULL
   106 000000F8 76616C6964206F7574-
   107 000000F8 7075742066696C6520-
   108 000000F8 6E616D652E20204D75-
   109 000000F8 737420626520272E62-
   110 000000F8 6D70272066696C652E-
   111 000000F8 0A00               
   112 00000130 4572726F722C20756E-    errReadFile db "Error, unable to open input file.", LF, NULL
   113 00000130 61626C6520746F206F-
   114 00000130 70656E20696E707574-
   115 00000130 2066696C652E0A00   
   116 00000153 4572726F722C20756E-    errWriteFile db "Error, unable to open output file.", LF, NULL
   117 00000153 61626C6520746F206F-
   118 00000153 70656E206F75747075-
   119 00000153 742066696C652E0A00 
   120                                 
   121                                 
   122                                 
   123                                 
   124                                 HEADER_SIZE equ 54
   125                                 
   126 00000177 4572726F722C20756E-    errReadHdr db "Error, unable to read header from source image file."
   127 00000177 61626C6520746F2072-
   128 00000177 656164206865616465-
   129 00000177 722066726F6D20736F-
   130 00000177 7572636520696D6167-
   131 00000177 652066696C652E     
   132 000001AB 0A00                    db LF, NULL
   133 000001AD 4572726F722C20696E-    errFileType db "Error, invalid file signature.", LF, NULL
   134 000001AD 76616C69642066696C-
   135 000001AD 65207369676E617475-
   136 000001AD 72652E0A00         
   137 000001CD 4572726F722C20756E-    errDepth db "Error, unsupported color depth.  Must be 24-bit color."
   138 000001CD 737570706F72746564-
   139 000001CD 20636F6C6F72206465-
   140 000001CD 7074682E20204D7573-
   141 000001CD 742062652032342D62-
   142 000001CD 697420636F6C6F722E 
   143 00000203 0A00                    db LF, NULL
   144 00000205 4572726F722C206F6E-    errCompType db "Error, only non-compressed images are supported."
   145 00000205 6C79206E6F6E2D636F-
   146 00000205 6D7072657373656420-
   147 00000205 696D61676573206172-
   148 00000205 6520737570706F7274-
   149 00000205 65642E             
   150 00000235 0A00                    db LF, NULL
   151 00000237 4572726F722C206269-    errSize db "Error, bitmap block size inconsistent.", LF, NULL
   152 00000237 746D617020626C6F63-
   153 00000237 6B2073697A6520696E-
   154 00000237 636F6E73697374656E-
   155 00000237 742E0A00           
   156 0000025F 4572726F722C20756E-    errWriteHdr db "Error, unable to write header to output image file.", LF,
   157 0000025F 61626C6520746F2077-
   158 0000025F 726974652068656164-
   159 0000025F 657220746F206F7574-
   160 0000025F 70757420696D616765-
   161 0000025F 2066696C652E0A     
   162 00000293 50726F6772616D2074-     db "Program terminated.", LF, NULL
   163 00000293 65726D696E61746564-
   164 00000293 2E0A00             
   165                                 
   166                                 
   167                                 
   168                                 
   169 000002A8 40420F0000000000       buffMax dq BUFF_SIZE
   170 000002B0 40420F0000000000       curr dq BUFF_SIZE
   171 000002B8 00                     wasEOF db FALSE
   172 000002B9 0000000000000000       pixelCount dq 0
   173                                 
   174 000002C1 4572726F722C207265-    errRead db "Error, reading from source image file.", LF,
   175 000002C1 6164696E672066726F-
   176 000002C1 6D20736F7572636520-
   177 000002C1 696D6167652066696C-
   178 000002C1 652E0A             
   179 000002E8 50726F6772616D2074-     db "Program terminated.", LF, NULL
   180 000002E8 65726D696E61746564-
   181 000002E8 2E0A00             
   182                                 
   183                                 
   184                                 
   185                                 
   186 000002FD 4572726F722C207772-    errWrite db "Error, writting to output image file.", LF,
   187 000002FD 697474696E6720746F-
   188 000002FD 206F75747075742069-
   189 000002FD 6D6167652066696C65-
   190 000002FD 2E0A               
   191 00000323 50726F6772616D2074-     db "Program terminated.", LF, NULL
   192 00000323 65726D696E61746564-
   193 00000323 2E0A00             
   194                                 
   195                                 
   196                                 
   197                                 
   198                                 
   199                                 [section .bss]
   200                                 
   201 00000000 <gap>                  localBuffer resb BUFF_SIZE
   202 000F4240 <gap>                  header resb HEADER_SIZE
   203                                 
   204                                 
   205                                 
   206                                 
   207                                 [section .text]
   208                                 
   209                                 
   210                                 
   211                                 
   212                                 
   213                                 
   214                                 
   215                                 
   216                                 
   217                                 
   218                                 
   219                                 
   220                                 
   221                                 
   222                                 
   223                                 
   224                                 
   225                                 
   226                                 
   227                                 
   228                                 
   229                                 
   230                                 
   231                                 
   232                                 
   233                                 [global getArguments]
   234                                 getArguments:
   235                                 
   236 00000000 55                     push rbp
   237 00000001 4889E5                 mov rbp, rsp
   238 00000004 4152                   push r10
   239 00000006 4153                   push r11
   240 00000008 4154                   push r12
   241 0000000A 4155                   push r13
   242 0000000C 4157                   push r15
   243                                 
   244                                 
   245                                 
   246                                 
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 
   252                                 
   253 0000000E 49C7C201000000         mov r10, 1
   254 00000015 49C7C300000000         mov r11, 0
   255 0000001C 4989CC                 mov r12, rcx
   256 0000001F 4D89C5                 mov r13, r8
   257                                 
   258                                 
   259 00000022 4E8B3CD6               mov r15, qword [rsi + r10 * 8]
   260 00000026 438A041F               mov al, byte [r15 + r11]
   261 0000002A 3C2D                   cmp al, 45
   262 0000002C 0F85F3000000           jne imInvalid
   263 00000032 49FFC3                 inc r11
   264 00000035 438A041F               mov al, byte [r15 + r11]
   265 00000039 3C67                   cmp al, 103
   266 0000003B 7506                   jne checkB
   267 0000003D C70200000000           mov dword [rdx], GRAYSCALE
   268 00000043 EB2E                   jmp checkSecondInput
   269                                 checkB:
   270 00000045 3C62                   cmp al, 98
   271 00000047 7511                   jne checkD
   272 00000049 49FFC3                 inc r11
   273 0000004C 3C72                   cmp al, 114
   274 0000004E 0F85D1000000           jne imInvalid
   275 00000054 C70201000000           mov dword [rdx], BRIGHTEN
   276 0000005A EB17                   jmp checkSecondInput
   277                                 checkD:
   278 0000005C 3C64                   cmp al, 100
   279 0000005E 0F85C1000000           jne imInvalid
   280 00000064 49FFC3                 inc r11
   281 00000067 3C6B                   cmp al, 107
   282 00000069 0F85B6000000           jne imInvalid
   283 0000006F C70202000000           mov dword [rdx], DARKEN
   284                                 
   285                                 checkSecondInput:
   286 00000075 49FFC2                 inc r10
   287 00000078 49C7C300000000         mov r11, 0
   288 0000007F 57                     push rdi
   289 00000080 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   290 00000084 E8A5030000             call checkFileExtension
   291 00000089 5F                     pop rdi
   292 0000008A 83F801                 cmp eax, TRUE
   293 0000008D 7574                   jne invalidReadFileName
   294 0000008F 57                     push rdi
   295 00000090 56                     push rsi
   296 00000091 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   297 00000095 E8E0030000             call openFile
   298 0000009A 5E                     pop rsi
   299 0000009B 5F                     pop rdi
   300 0000009C 4883F800               cmp rax, 0
   301 000000A0 7274                   jb openFileError
   302 000000A2 49890424               mov qword [r12], rax
   303 000000A6 49FFC2                 inc r10
   304 000000A9 57                     push rdi
   305 000000AA 56                     push rsi
   306 000000AB 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   307 000000AF E87A030000             call checkFileExtension
   308 000000B4 5E                     pop rsi
   309 000000B5 5F                     pop rdi
   310 000000B6 83F801                 cmp eax, TRUE
   311 000000B9 7535                   jne invalidWriteFileName
   312 000000BB 57                     push rdi
   313 000000BC 56                     push rsi
   314 000000BD 4A8B3CD6               mov rdi, qword [rsi + r10 * 8]
   315 000000C1 E8CF030000             call createFile
   316 000000C6 5E                     pop rsi
   317 000000C7 5F                     pop rdi
   318 000000C8 4883F800               cmp rax, 0
   319 000000CC 720C                   jb createFileError
   320 000000CE 49894500               mov qword [r13], rax
   321                                 
   322 000000D2 B801000000             mov eax, TRUE
   323                                 
   324 000000D7 E996000000             jmp done
   325                                 createFileError:
   326 000000DC 48C7C7[00000000]       mov rdi, errWriteFile
   327 000000E3 E813030000             call printString
   328 000000E8 B800000000             mov eax, FALSE
   329 000000ED E980000000             jmp done
   330                                 
   331                                 invalidWriteFileName:
   332 000000F2 48C7C7[00000000]       mov rdi, errWriteName
   333 000000F9 E8FD020000             call printString
   334 000000FE B800000000             mov eax, FALSE
   335 00000103 EB70                   jmp done
   336                                 
   337                                 invalidReadFileName:
   338 00000105 48C7C7[00000000]       mov rdi, errReadName
   339 0000010C E8EA020000             call printString
   340 00000111 B800000000             mov eax, FALSE
   341 00000116 EB5D                   jmp done
   342                                 
   343                                 openFileError:
   344 00000118 48C7C7[00000000]       mov rdi, errReadFile
   345 0000011F E8D7020000             call printString
   346 00000124 B800000000             mov eax, FALSE
   347 00000129 EB4A                   jmp done
   348                                 
   349                                 imInvalid:
   350 0000012B 48C7C7[00000000]       mov rdi, errOption
   351 00000132 E8C4020000             call printString
   352 00000137 B800000000             mov eax, FALSE
   353 0000013C EB37                   jmp done
   354                                 
   355                                 incorrectUsage:
   356 0000013E 48C7C7[00000000]       mov rdi, usageMsg
   357 00000145 E8B1020000             call printString
   358 0000014A B800000000             mov eax, FALSE
   359 0000014F EB24                   jmp done
   360                                 
   361                                 tooFewArgs:
   362 00000151 48C7C7[00000000]       mov rdi, errIncomplete
   363 00000158 E89E020000             call printString
   364 0000015D B800000000             mov eax, FALSE
   365 00000162 EB11                   jmp done
   366                                 
   367                                 tooManyArgs:
   368 00000164 48C7C7[00000000]       mov rdi, errExtra
   369 0000016B E88B020000             call printString
   370 00000170 B800000000             mov eax, FALSE
   371 00000175 EBFE                   jmp done
   372                                 
   373                                 done:
   374 00000177 415F                   pop r15
   375 00000179 415D                   pop r13
   376 0000017B 415C                   pop r12
   377 0000017D 415B                   pop r11
   378 0000017F 415A                   pop r10
   379 00000181 5D                     pop rbp
   380                                 
   381 00000182 C3                     ret
   382                                 
   383                                 
   384                                 
   385                                 
   386                                 
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 
   404                                 
   405                                 
   406                                 
   407                                 
   408                                 
   409                                 
   410                                 
   411                                 
   412                                 
   413                                 
   414                                 
   415                                 
   416                                 
   417                                 
   418                                 
   419                                 [global processHeaders]
   420                                 processHeaders:
   421                                 
   422 00000183 53                     push rbx
   423 00000184 4152                   push r10
   424 00000186 4153                   push r11
   425 00000188 4154                   push r12
   426 0000018A 4155                   push r13
   427 0000018C 4156                   push r14
   428 0000018E 4157                   push r15
   429                                 
   430 00000190 4889FB                 mov rbx, rdi
   431 00000193 49C7C200000000         mov r10, 0
   432 0000019A 4989CC                 mov r12, rcx
   433 0000019D 4D89C5                 mov r13, r8
   434 000001A0 4989D7                 mov r15, rdx
   435 000001A3 57                     push rdi
   436 000001A4 56                     push rsi
   437 000001A5 52                     push rdx
   438 000001A6 48C7C000000000         mov rax, SYS_read
   439 000001AD 4889DF                 mov rdi, rbx
   440 000001B0 48C7C6[00000000]       mov rsi, header
   441 000001B7 48C7C236000000         mov rdx, HEADER_SIZE
   442 000001BE 0F05                   syscall
   443 000001C0 5A                     pop rdx
   444 000001C1 5E                     pop rsi
   445 000001C2 5F                     pop rdi
   446 000001C3 83F800                 cmp eax, 0
   447 000001C6 0F823A010000           jb errorOnRead
   448                                 
   449                                 
   450 000001CC 418A82[00000000]       mov al, byte [header + r10]
   451 000001D3 3C42                   cmp al, 66
   452 000001D5 0F8518010000           jne fileTypeError
   453 000001DB 49FFC2                 inc r10
   454 000001DE 418A82[00000000]       mov al, byte [header + r10]
   455 000001E5 3C4D                   cmp al, 77
   456 000001E7 0F8506010000           jne fileTypeError
   457 000001ED 49FFC2                 inc r10
   458 000001F0 418B82[00000000]       mov eax, dword [header + r10]
   459 000001F7 418907                 mov dword [r15], eax
   460 000001FA 4983C208               add r10, 8
   461 000001FE 418B82[00000000]       mov eax, dword [header + r10]
   462 00000205 83F836                 cmp eax, 54
   463 00000208 0F85AC000000           jne invalidBitmapSize
   464 0000020E 4189C6                 mov r14d, eax
   465 00000211 4983C204               add r10, 4
   466 00000215 418B82[00000000]       mov eax, dword [header + r10]
   467 0000021C 4983C204               add r10, 4
   468 00000220 418B82[00000000]       mov eax, dword [header + r10]
   469 00000227 41890424               mov dword [r12], eax
   470 0000022B 4983C204               add r10, 4
   471 0000022F 418B82[00000000]       mov eax, dword [header + r10]
   472 00000236 41894500               mov dword [r13], eax
   473 0000023A 4983C204               add r10, 4
   474 0000023E 66418B82[00000000]     mov ax, word [header + r10]
   475 00000246 4983C202               add r10, 2
   476 0000024A 66418B82[00000000]     mov ax, word [header + r10]
   477 00000252 6683F818               cmp ax, 24
   478 00000256 0F8584000000           jne depthError
   479 0000025C 4983C202               add r10, 2
   480 00000260 418B82[00000000]       mov eax, dword [header + r10]
   481 00000267 83F800                 cmp eax, 0
   482 0000026A 7565                   jne compTypeError
   483 0000026C 4983C204               add r10, 4
   484 00000270 418B82[00000000]       mov eax, dword [header + r10]
   485 00000277 4401F0                 add eax, r14d
   486 0000027A 458B1F                 mov r11d, dword [r15]
   487 0000027D 413907                 cmp dword [r15], eax
   488 00000280 753C                   jne invalidBitmapSize
   489                                 
   490                                 
   491 00000282 4989F4                 mov r12, rsi
   492 00000285 52                     push rdx
   493 00000286 48C7C001000000         mov rax, SYS_write
   494 0000028D 4C89E7                 mov rdi, r12
   495 00000290 48C7C6[00000000]       mov rsi, header
   496 00000297 48C7C236000000         mov rdx, HEADER_SIZE
   497 0000029E 0F05                   syscall
   498 000002A0 5A                     pop rdx
   499 000002A1 83F800                 cmp eax, 0
   500 000002A4 7205                   jb errorToWrite
   501                                 
   502 000002A6 B801000000             mov eax, TRUE
   503 000002AB EB70                   jmp done1
   504                                 
   505                                 errorToWrite:
   506 000002AD 48C7C7[00000000]       mov rdi, errWriteFile
   507 000002B4 E842010000             call printString
   508 000002B9 B800000000             mov eax, FALSE
   509 000002BE EB5D                   jmp done1
   510                                 
   511                                 invalidBitmapSize:
   512 000002C0 48C7C7[00000000]       mov rdi, errSize
   513 000002C7 E82F010000             call printString
   514 000002CC B800000000             mov eax, FALSE
   515 000002D1 EB4A                   jmp done1
   516                                 
   517                                 compTypeError:
   518 000002D3 48C7C7[00000000]       mov rdi, errCompType
   519 000002DA E81C010000             call printString
   520 000002DF B800000000             mov eax, FALSE
   521 000002E4 EB37                   jmp done1
   522                                 
   523                                 depthError:
   524 000002E6 48C7C7[00000000]       mov rdi, errDepth
   525 000002ED E809010000             call printString
   526 000002F2 B800000000             mov eax, FALSE
   527 000002F7 EB24                   jmp done1
   528                                 
   529                                 fileTypeError:
   530 000002F9 48C7C7[00000000]       mov rdi, errFileType
   531 00000300 E8F6000000             call printString
   532 00000305 B800000000             mov eax, FALSE
   533 0000030A EB11                   jmp done1
   534                                 
   535                                 errorOnRead:
   536 0000030C 48C7C7[00000000]       mov rdi, errReadHdr
   537 00000313 E8E3000000             call printString
   538 00000318 B800000000             mov eax, FALSE
   539 0000031D EBFE                   jmp done1
   540                                 
   541                                 done1:
   542 0000031F 415F                   pop r15
   543 00000321 415E                   pop r14
   544 00000323 415D                   pop r13
   545 00000325 415C                   pop r12
   546 00000327 415B                   pop r11
   547 00000329 415A                   pop r10
   548 0000032B 5B                     pop rbx
   549                                 
   550 0000032C C3                     ret
   551                                 
   552                                 
   553                                 
   554                                 
   555                                 
   556                                 
   557                                 
   558                                 
   559                                 
   560                                 
   561                                 
   562                                 
   563                                 
   564                                 
   565                                 
   566                                 
   567                                 
   568                                 
   569                                 
   570                                 
   571                                 
   572                                 
   573                                 
   574                                 
   575                                 
   576                                 
   577                                 
   578                                 
   579                                 [global getRow]
   580                                 getRow:
   581                                 
   582 0000032D 53                     push rbx
   583 0000032E 4152                   push r10
   584 00000330 4157                   push r15
   585                                 
   586 00000332 4889FB                 mov rbx, rdi
   587 00000335 4989F2                 mov r10, rsi
   588 00000338 4989D7                 mov r15, rdx
   589                                 
   590 0000033B 48C7C000000000         mov rax, SYS_read
   591 00000342 4889DF                 mov rdi, rbx
   592 00000345 4C89FE                 mov rsi, r15
   593 00000348 48C7C240420F00         mov rdx, BUFF_SIZE
   594 0000034F 0F05                   syscall
   595 00000351 4883F800               cmp rax, 0
   596 00000355 7205                   jb readError
   597                                 
   598 00000357 B801000000             mov eax, TRUE
   599 0000035C EB11                   jmp done2
   600                                 
   601                                 readError:
   602 0000035E 48C7C7[00000000]       mov rdi, errReadFile
   603 00000365 E891000000             call printString
   604 0000036A B800000000             mov eax, FALSE
   605 0000036F EBFE                   jmp done2
   606                                 
   607                                 done2:
   608 00000371 415F                   pop r15
   609 00000373 415A                   pop r10
   610 00000375 5B                     pop rbx
   611                                 
   612 00000376 C3                     ret
   613                                 
   614                                 
   615                                 
   616                                 
   617                                 
   618                                 
   619                                 
   620                                 
   621                                 
   622                                 
   623                                 
   624                                 
   625                                 
   626                                 
   627                                 
   628                                 
   629                                 
   630                                 
   631                                 
   632                                 
   633                                 
   634                                 
   635                                 
   636                                 
   637                                 
   638                                 
   639                                 [global writeRow]
   640                                 writeRow:
   641                                 
   642 00000377 C3                     ret
   643                                 
   644                                 
   645                                 
   646                                 
   647                                 
   648                                 
   649                                 
   650                                 
   651                                 
   652                                 
   653                                 
   654                                 
   655                                 
   656                                 
   657                                 
   658                                 
   659                                 
   660                                 [global imageCvtToBW]
   661                                 imageCvtToBW:
   662                                 
   663 00000378 53                     push rbx
   664 00000379 4152                   push r10
   665 0000037B 4154                   push r12
   666 0000037D 4155                   push r13
   667 0000037F 4156                   push r14
   668 00000381 4157                   push r15
   669                                 
   670 00000383 4889FB                 mov rbx, rdi
   671 00000386 4989F2                 mov r10, rsi
   672 00000389 49C7C400000000         mov r12, 0
   673 00000390 49C7C500000000         mov r13, 0
   674 00000397 48C7C000000000         mov rax, 0
   675 0000039E 49C7C700000000         mov r15, 0
   676 000003A5 49C7C603000000         mov r14, 3
   677                                 
   678                                 cvtToBw:
   679 000003AC 478A2C22               mov r13b, byte [r10 + r12]
   680 000003B0 4401E8                 add eax, r13d
   681 000003B3 49FFC7                 inc r15
   682 000003B6 49FFC4                 inc r12
   683 000003B9 4983FF03               cmp r15, 3
   684 000003BD 7403                   je cvtColor
   685 000003BF 4D39D4                 cmp r12, r10
   686 000003C2 72E6                   jb cvtToBw
   687                                 
   688                                 cvtColor:
   689 000003C4 6641F7F6               div r14w
   690 000003C8 4154                   push r12
   691 000003CA 4983EC03               sub r12, 3
   692 000003CE 43880422               mov byte [r10 + r12], al
   693 000003D2 49FFC4                 inc r12
   694 000003D5 43880422               mov byte [r10 + r12], al
   695 000003D9 49FFC4                 inc r12
   696 000003DC 43880422               mov byte [r10 + r12], al
   697 000003E0 49C7C700000000         mov r15, 0
   698 000003E7 48C7C000000000         mov rax, 0
   699 000003EE 415C                   pop r12
   700 000003F0 EBB8                   jmp cvtToBw
   701                                 
   702 000003F2 415F                   pop r15
   703 000003F4 415E                   pop r14
   704 000003F6 415D                   pop r13
   705 000003F8 415C                   pop r12
   706 000003FA 415A                   pop r10
   707 000003FC 5B                     pop rbx
   708                                 
   709                                 
   710 000003FD C3                     ret
   711                                 
   712                                 
   713                                 
   714                                 
   715                                 
   716                                 
   717                                 
   718                                 
   719                                 
   720                                 
   721                                 
   722                                 
   723                                 
   724                                 
   725                                 
   726                                 
   727                                 
   728                                 [global imageBrighten]
   729                                 imageBrighten:
   730                                 
   731 000003FE C3                     ret
   732                                 
   733                                 
   734                                 
   735                                 
   736                                 
   737                                 
   738                                 
   739                                 
   740                                 
   741                                 
   742                                 
   743                                 
   744                                 
   745                                 
   746                                 
   747                                 
   748                                 
   749                                 [global imageDarken]
   750                                 imageDarken:
   751                                 
   752 000003FF C3                     ret
   753                                 
   754                                 
   755                                 
   756                                 
   757                                 
   758                                 
   759                                 
   760                                 
   761                                 
   762                                 
   763                                 
   764                                 
   765                                 
   766                                 
   767                                 
   768                                 [global printString]
   769                                 printString:
   770 00000400 53                      push rbx
   771                                 
   772                                 
   773                                 
   774                                 
   775 00000401 4889FB                  mov rbx, rdi
   776 00000404 48C7C200000000          mov rdx, 0
   777                                 strCountLoop:
   778 0000040B 803B00                  cmp byte [rbx], NULL
   779 0000040E 7406                    je strCountDone
   780 00000410 48FFC3                  inc rbx
   781 00000413 48FFC2                  inc rdx
   782 00000416 EBF1                    jmp strCountLoop
   783                                 strCountDone:
   784                                 
   785 00000418 4883FA00                cmp rdx, 0
   786 0000041C 7411                    je prtDone
   787                                 
   788                                 
   789                                 
   790                                 
   791 0000041E 48C7C001000000          mov rax, SYS_write
   792 00000425 4889FE                  mov rsi, rdi
   793 00000428 48C7C701000000          mov rdi, STDOUT
   794                                 
   795 0000042F 0F05                    syscall
   796                                 
   797                                 
   798                                 
   799                                 
   800                                 prtDone:
   801 00000431 5B                      pop rbx
   802 00000432 C3                      ret
   803                                 
   804                                 
   805                                 
   806                                 
   807                                 
   808                                 
   809                                 [global checkFileExtension]
   810                                 checkFileExtension:
   811                                 
   812 00000433 4152                   push r10
   813                                 
   814 00000435 49C7C200000000         mov r10, 0
   815                                 searchExt:
   816 0000043C 428A0417               mov al, byte [rdi + r10]
   817 00000440 49FFC2                 inc r10
   818 00000443 3C2E                   cmp al, 46
   819 00000445 75F3                   jne searchExt
   820 00000447 428A0417               mov al, byte [rdi + r10]
   821 0000044B 3C62                   cmp al, 98
   822 0000044D 7526                   jne invalidFileExtension
   823 0000044F 49FFC2                 inc r10
   824 00000452 428A0417               mov al, byte [rdi + r10]
   825 00000456 3C6D                   cmp al, 109
   826 00000458 751B                   jne invalidFileExtension
   827 0000045A 49FFC2                 inc r10
   828 0000045D 428A0417               mov al, byte [rdi + r10]
   829 00000461 3C70                   cmp al, 112
   830 00000463 7510                   jne invalidFileExtension
   831 00000465 49FFC2                 inc r10
   832 00000468 428A0417               mov al, byte [rdi + r10]
   833 0000046C 3C00                   cmp al, NULL
   834 0000046E 7505                   jne invalidFileExtension
   835                                 
   836 00000470 B801000000             mov eax, TRUE
   837 00000475 EB03                   jmp extensionReturn
   838                                 
   839                                 invalidFileExtension:
   840 00000477 B800000000             mov eax, FALSE
   841                                 
   842                                 extensionReturn:
   843 0000047C 415A                   pop r10
   844                                 
   845 0000047E C3                     ret
   846                                 
   847                                 
   848                                 
   849                                 [global openFile]
   850                                 openFile:
   851                                 
   852 0000047F 4152                   push r10
   853                                 
   854 00000481 4C8D17                 lea r10, qword [rdi]
   855                                 
   856 00000484 48C7C002000000         mov rax, SYS_open
   857 0000048B 4C89D7                 mov rdi, r10
   858 0000048E 48C7C600000000         mov rsi, O_RDONLY
   859 00000495 0F05                   syscall
   860                                 
   861 00000497 415A                   pop r10
   862                                 
   863 00000499 C3                     ret
   864                                 
   865                                 
   866                                 
   867                                 [global createFile]
   868                                 createFile:
   869                                 
   870 0000049A 4152                   push r10
   871                                 
   872 0000049C 4C8D17                 lea r10, qword [rdi]
   873                                 
   874 0000049F 48C7C055000000         mov rax, SYS_creat
   875 000004A6 4C89D7                 mov rdi, r10
   876 000004A9 48C7C680010000         mov rsi, S_IRUSR | S_IWUSR
   877 000004B0 0F05                   syscall
   878                                 
   879 000004B2 415A                   pop r10
   880                                 
   881 000004B4 C3                     ret
