     1                                 %line 1+1 ast9procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 [section .data]
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 TRUE equ 1
    35                                 FALSE equ 0
    36                                 
    37                                 EXIT_SUCCESS equ 0
    38                                 
    39                                 STDIN equ 0
    40                                 STDOUT equ 1
    41                                 STDERR equ 2
    42                                 
    43                                 SYS_read equ 0
    44                                 SYS_write equ 1
    45                                 SYS_open equ 2
    46                                 SYS_close equ 3
    47                                 SYS_fork equ 57
    48                                 SYS_exit equ 60
    49                                 SYS_creat equ 85
    50                                 SYS_time equ 201
    51                                 
    52                                 LF equ 10
    53                                 SPACE equ " "
    54                                 NULL equ 0
    55                                 ESC equ 27
    56                                 
    57                                 
    58                                 
    59                                 
    60                                 SUCCESS equ 0
    61                                 NOSUCCESS equ 1
    62                                 OUTOFRANGEMIN equ 2
    63                                 OUTOFRANGEMAX equ 3
    64                                 INPUTOVERFLOW equ 4
    65                                 ENDOFINPUT equ 5
    66                                 
    67                                 MIN_NUM equ 1
    68                                 MAX_NUM equ 50000
    69                                 
    70                                 BUFFSIZE equ 50
    71                                 
    72                                 
    73                                 
    74                                 
    75                                 
    76                                 
    77                                 [section .text]
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                 
    86                                 
    87                                 
    88                                 
    89                                 
    90                                 
    91                                 
    92                                 
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103                                 
   104                                 
   105                                 
   106                                 [global readSenaryNum]
   107                                 readSenaryNum:
   108                                 
   109                                 
   110                                 
   111                                 
   112                                 
   113                                 
   114                                 
   115                                 
   116                                 
   117                                 
   118                                 
   119                                 
   120                                 
   121                                 
   122                                 
   123 00000000 55                     push rbp
   124 00000001 4889E5                 mov rbp, rsp
   125 00000004 4883ED32               sub rbp, BUFFSIZE
   126 00000008 48FFCD                 dec rbp
   127 0000000B 57                     push rdi
   128 0000000C 52                     push rdx
   129 0000000D 53                     push rbx
   130 0000000E 4154                   push r12
   131 00000010 4153                   push r11
   132 00000012 4156                   push r14
   133 00000014 4157                   push r15
   134 00000016 51                     push rcx
   135 00000017 4155                   push r13
   136                                 
   137                                 
   138 00000019 49C7C400000000         mov r12, 0
   139 00000020 488D5D01               lea rbx, [rbp + 1]
   140 00000024 4989FF                 mov r15, rdi
   141 00000027 49C7C500000000         mov r13, 0
   142 0000002E 49C7C600000000         mov r14, 0
   143                                 readChars:
   144 00000035 48C7C000000000         mov rax, SYS_read
   145 0000003C 48C7C700000000         mov rdi, STDIN
   146 00000043 488D7500               lea rsi, byte [rbp]
   147 00000047 48C7C201000000         mov rdx, 1
   148 0000004E 0F05                   syscall
   149 00000050 8A4500                 mov al, byte [rbp]
   150                                 
   151 00000053 3C0A                   cmp al, LF
   152 00000055 742E                   je readDone
   153                                 
   154 00000057 4983FD01               cmp r13, 1
   155 0000005B 7400                   je checkNonLeadingSpace
   156 0000005D EB0B                   jmp ignoreLeadingSpace
   157                                 checkNonLeadingSpace:
   158 0000005F 3C20                   cmp al, SPACE
   159 00000061 7400                   je markInvalid
   160 00000063 EB05                   jmp ignoreLeadingSpace
   161                                 markInvalid:
   162 00000065 49C7C601000000         mov r14, 1
   163                                 ignoreLeadingSpace:
   164                                 
   165 0000006C 3C20                   cmp al, SPACE
   166 0000006E 74C3                   je readChars
   167                                 
   168 00000070 49FFC4                 inc r12
   169 00000073 4983FC32               cmp r12, BUFFSIZE
   170 00000077 73BA                   jae readChars
   171                                 
   172 00000079 49C7C501000000         mov r13, 1
   173 00000080 8803                   mov byte [rbx], al
   174 00000082 48FFC3                 inc rbx
   175                                 
   176 00000085 EBAC                   jmp readChars
   177                                 readDone:
   178 00000087 C60300                 mov byte [rbx], NULL
   179                                 
   180 0000008A 4983FE01               cmp r14, 1
   181 0000008E 0F84A8000000           je invalidNumber
   182                                 
   183                                 
   184 00000094 4983FC32               cmp r12, BUFFSIZE
   185 00000098 0F83A5000000           jae lengthExceeded
   186                                 
   187 0000009E 4983FC00               cmp r12, 0
   188 000000A2 0F84A2000000           je emptyInput
   189                                 
   190 000000A8 488D5D01               lea rbx, [rbp + 1]
   191 000000AC 803B30                 cmp byte [rbx], 48
   192 000000AF 7400                   je ignoreLeadingZero
   193 000000B1 EB0F                   jmp skip
   194                                 ignoreLeadingZero:
   195 000000B3 8A03                   mov al, byte [rbx]
   196 000000B5 3C30                   cmp al, 48
   197 000000B7 7509                   jne skip
   198 000000B9 48FFC3                 inc rbx
   199 000000BC 49FFCC                 dec r12
   200 000000BF 803B00                 cmp byte [rbx], NULL
   201 000000C2 75ED                   jne ignoreLeadingZero
   202                                 skip:
   203                                 
   204 000000C4 49C7C300000000         mov r11, 0
   205 000000CB 4D89E5                 mov r13, r12
   206 000000CE 49FFCD                 dec r13
   207 000000D1 48C7C106000000         mov rcx, 6
   208 000000D8 49C7C600000000         mov r14, 0
   209                                 
   210                                 toDigit:
   211 000000DF 420FB6041B             movzx eax, byte [rbx + r11]
   212                                 
   213 000000E4 3C00                   cmp al, 0
   214 000000E6 744A                   je belowMin
   215                                 
   216 000000E8 3C30                   cmp al, 48
   217 000000EA 7254                   jb invalidNumber
   218                                 
   219 000000EC 3C36                   cmp al, 54
   220 000000EE 7350                   jae invalidNumber
   221 000000F0 83E830                 sub eax, 48
   222                                 
   223 000000F3 4983FD00               cmp r13, 0
   224 000000F7 7500                   jne exp
   225 000000F9 EB09                   jmp continue3
   226                                 
   227                                 exp:
   228 000000FB F7E1                   mul ecx
   229 000000FD 49FFCD                 dec r13
   230 00000100 4983FD00               cmp r13, 0
   231 00000104 75F3                   jne exp
   232                                 
   233                                 continue3:
   234 00000106 4101C6                 add r14d, eax
   235                                 
   236 00000109 49FFC3                 inc r11
   237 0000010C 49FFCC                 dec r12
   238 0000010F 4D89E5                 mov r13, r12
   239 00000112 49FFCD                 dec r13
   240 00000115 4983FC00               cmp r12, 0
   241 00000119 75C2                   jne toDigit
   242                                 
   243 0000011B 4983FE01               cmp r14, MIN_NUM
   244 0000011F 7211                   jb belowMin
   245                                 
   246 00000121 4981FE50C30000         cmp r14, MAX_NUM
   247 00000128 730F                   jae aboveMax
   248                                 
   249                                 
   250 0000012A 458937                 mov dword [r15], r14d
   251 0000012D B800000000             mov eax, 0
   252 00000132 EB21                   jmp done
   253                                 
   254                                 belowMin:
   255 00000134 B802000000             mov eax, 2
   256 00000139 EB1A                   jmp done
   257                                 
   258                                 aboveMax:
   259 0000013B B803000000             mov eax, 3
   260 00000140 EB13                   jmp done
   261                                 
   262                                 invalidNumber:
   263 00000142 B801000000             mov eax, 1
   264 00000147 EB0C                   jmp done
   265                                 
   266                                 lengthExceeded:
   267 00000149 B804000000             mov eax, 4
   268 0000014E EB05                   jmp done
   269                                 
   270                                 emptyInput:
   271 00000150 B805000000             mov eax, 5
   272 00000155 EBFE                   jmp done
   273                                 
   274                                 done:
   275 00000157 415D                   pop r13
   276 00000159 59                     pop rcx
   277 0000015A 415F                   pop r15
   278 0000015C 415E                   pop r14
   279 0000015E 415B                   pop r11
   280 00000160 415C                   pop r12
   281 00000162 5B                     pop rbx
   282 00000163 5A                     pop rdx
   283 00000164 5F                     pop rdi
   284 00000165 5D                     pop rbp
   285                                 
   286 00000166 C3                     ret
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 
   293                                 
   294                                 
   295                                 
   296                                 
   297                                 
   298                                 
   299                                 
   300                                 
   301                                 
   302                                 
   303                                 
   304                                 
   305                                 
   306                                 
   307                                 
   308                                 
   309                                 
   310                                 
   311                                 
   312                                 
   313                                 
   314                                 
   315                                 
   316                                 
   317                                 
   318                                 
   319                                 
   320                                 
   321                                 
   322                                 
   323                                 
   324                                 
   325                                 
   326                                 
   327                                 
   328                                 [global oddEvenSort]
   329                                 oddEvenSort:
   330                                 
   331 00000167 4154                   push r12
   332 00000169 4155                   push r13
   333 0000016B 53                     push rbx
   334 0000016C 51                     push rcx
   335 0000016D 4157                   push r15
   336                                 
   337                                 while:
   338 0000016F 41B701                 mov r15b, 1
   339 00000172 49C7C401000000         mov r12, 1
   340 00000179 4189F5                 mov r13d, esi
   341 0000017C 4183ED01               sub r13d, 1
   342                                 
   343                                 forLoop1:
   344 00000180 4539EC                 cmp r12d, r13d
   345 00000183 731D                   jae nextLoop
   346                                 
   347                                 
   348 00000185 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   349 00000189 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   350                                 
   351 0000018E 39CB                   cmp ebx, ecx
   352 00000190 760A                   jbe continue1
   353                                 
   354 00000192 42890CA7               mov dword [rdi + r12 * 4], ecx
   355 00000196 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   356 0000019B 41B700                 mov r15b, 0
   357                                 
   358                                 continue1:
   359 0000019E 4983C402               add r12, 2
   360 000001A2 EBDA                   jmp forLoop1
   361                                 nextLoop:
   362 000001A4 49C7C400000000         mov r12, 0
   363                                 
   364                                 forLoop2:
   365 000001AB 4539EC                 cmp r12d, r13d
   366 000001AE 731D                   jae whileCondition
   367                                 
   368                                 
   369 000001B0 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   370 000001B4 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   371                                 
   372 000001B9 39CB                   cmp ebx, ecx
   373 000001BB 760A                   jbe continue2
   374                                 
   375 000001BD 42890CA7               mov dword [rdi + r12 * 4], ecx
   376 000001C1 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   377 000001C6 41B700                 mov r15b, 0
   378                                 
   379                                 continue2:
   380 000001C9 4983C402               add r12, 2
   381 000001CD EBDA                   jmp forLoop2
   382                                 whileCondition:
   383 000001CF 4180FF00               cmp r15b, 0
   384 000001D3 7498                   je while
   385                                 
   386 000001D5 415F                   pop r15
   387 000001D7 59                     pop rcx
   388 000001D8 5A                     pop rdx
   389 000001D9 415D                   pop r13
   390 000001DB 415C                   pop r12
   391                                 
   392 000001DD C3                     ret
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 
   404                                 
   405                                 
   406                                 
   407                                 
   408                                 
   409                                 
   410                                 
   411                                 
   412                                 
   413                                 
   414                                 
   415                                 
   416                                 
   417                                 
   418                                 
   419                                 
   420                                 
   421                                 
   422                                 [global listStats]
   423                                 listStats:
   424                                 
   425                                 
   426                                 
   427 000001DE 55                      push rbp
   428 000001DF 4889E5                  mov rbp, rsp
   429 000001E2 4154                    push r12
   430 000001E4 4155                    push r13
   431                                 
   432 000001E6 448B27                  mov r12d, dword [rdi]
   433 000001E9 448922                  mov dword [rdx], r12d
   434 000001EC 448B64B7FC              mov r12d, dword [rdi + ((rsi * 4) - 4)]
   435 000001F1 448921                  mov dword [rcx], r12d
   436                                 
   437 000001F4 49C7C400000000          mov r12, 0
   438 000001FB 49C7C500000000          mov r13, 0
   439                                  sumLoop:
   440 00000202 46032CA7                add r13d, dword [rdi + r12 * 4]
   441 00000206 49FFC4                  inc r12
   442 00000209 4939F4                  cmp r12, rsi
   443 0000020C 72F2                    jb sumLoop
   444 0000020E 458929                  mov dword [r9], r13d
   445                                 
   446 00000211 4C8B6D10                mov r13, qword [rbp + 16]
   447 00000215 418B01                  mov eax, dword [r9]
   448 00000218 99                      cdq
   449 00000219 F7F6                    div esi
   450 0000021B 49894500                mov qword [r13], rax
   451                                 
   452                                 
   453 0000021F 52                      push rdx
   454 00000220 89F0                    mov eax, esi
   455 00000222 99                      cdq
   456 00000223 49C7C402000000          mov r12, 2
   457 0000022A 49F7F4                  div r12
   458 0000022D 4883FA01                cmp rdx, 1
   459 00000231 750B                    jne evenLength1
   460                                 
   461 00000233 4D89C5                  mov r13, r8
   462 00000236 448B2487                mov r12d, dword [rdi + rax * 4]
   463 0000023A 45896500                mov dword [r13], r12d
   464 0000023E EB18                    jmp statsDone
   465                                 
   466                                  evenLength1:
   467 00000240 49C7C400000000          mov r12, 0
   468 00000247 448B2487                mov r12d, dword [rdi + rax * 4]
   469 0000024B 44036487FC              add r12d, dword [rdi + ((rax * 4) - 4)]
   470 00000250 41D1EC                  shr r12d, 1
   471 00000253 4D89C5                  mov r13, r8
   472 00000256 45896500                mov dword [r13], r12d
   473                                 
   474                                  statsDone:
   475 0000025A 5A                      pop rdx
   476 0000025B 415D                    pop r13
   477 0000025D 415C                    pop r12
   478 0000025F 5D                      pop rbp
   479                                 
   480 00000260 C3                      ret
   481                                 
   482                                 
   483                                 
   484                                 
   485                                 
   486                                 
   487                                 
   488                                 
   489                                 
   490                                 
   491                                 
   492                                 
   493                                 
   494                                 
   495                                 
   496                                 
   497                                 
   498                                 
   499                                 
   500                                 
   501                                 
   502                                 
   503                                 
   504                                 [global estimatedMedian]
   505                                 estimatedMedian:
   506                                 
   507                                 
   508                                 
   509 00000261 52                      push rdx
   510 00000262 4154                    push r12
   511 00000264 89F0                    mov eax, esi
   512 00000266 99                      cdq
   513 00000267 49C7C402000000          mov r12, 2
   514 0000026E 41F7F4                  div r12d
   515 00000271 4883FA01                cmp rdx, 1
   516 00000275 750A                    jne evenLength2
   517                                 
   518                                 
   519 00000277 4989F4                  mov r12, rsi
   520 0000027A 49D1EC                  shr r12, 1
   521 0000027D 428B04A7                mov eax, dword [rdi + r12 * 4]
   522 00000281 EB0F                    jmp medianDone
   523                                 
   524                                  evenLength2:
   525 00000283 4989F4                  mov r12, rsi
   526 00000286 49D1EC                  shr r12, 1
   527 00000289 428B04A7                mov eax, dword [rdi + r12 * 4]
   528 0000028D 420344A7FC              add eax, dword [rdi + ((r12 * 4) - 4)]
   529 00000292 D1E8                    shr eax, 1
   530                                 
   531                                  medianDone:
   532 00000294 415C                    pop r12
   533 00000296 5A                      pop rdx
   534                                 
   535 00000297 C3                      ret
   536                                 
   537                                 
   538                                 
   539                                 
   540                                 
   541                                 
   542                                 
   543                                 
   544                                 
   545                                 
   546                                 
   547                                 
   548                                 
   549                                 
   550                                 
   551                                 
   552                                 
   553                                 
   554                                 
   555                                 
   556                                 
   557                                 
   558                                 
   559                                 
   560                                 
   561                                 
   562                                 
   563                                 
   564                                 [global estimatedSkew]
   565                                 estimatedSkew:
   566                                 
   567                                 
   568                                 
   569                                 
   570                                 
   571 00000298 4154                    push r12
   572 0000029A 4155                    push r13
   573 0000029C 4156                    push r14
   574 0000029E 4157                    push r15
   575 000002A0 4152                    push r10
   576                                 
   577 000002A2 49C7C400000000          mov r12, 0
   578 000002A9 4989F6                  mov r14, rsi
   579 000002AC 49FFCE                  dec r14
   580 000002AF 49C7C700000000          mov r15, 0
   581 000002B6 49C7C200000000          mov r10, 0
   582                                 
   583                                  skewLoop:
   584                                 
   585 000002BD 428B04A7                mov eax, dword [rdi + r12 * 4]
   586 000002C1 29D0                    sub eax, edx
   587 000002C3 52                      push rdx
   588 000002C4 99                      cdq
   589 000002C5 F7E0                    mul eax
   590 000002C7 4189C7                  mov r15d, eax
   591 000002CA 4D89FD                  mov r13, r15
   592 000002CD 4D01EA                  add r10, r13
   593 000002D0 5A                      pop rdx
   594 000002D1 49FFC4                  inc r12
   595 000002D4 4D39F4                  cmp r12, r14
   596 000002D7 76E2                    jbe skewLoop
   597                                 
   598 000002D9 90                      nop
   599 000002DA 49C7C403000000          mov r12, 3
   600 000002E1 89F0                    mov eax, esi
   601 000002E3 41F7E4                  mul r12d
   602 000002E6 4989C4                  mov r12, rax
   603 000002E9 4C89D0                  mov rax, r10
   604 000002EC 4899                    cqo
   605 000002EE 49F7F4                  div r12
   606 000002F1 90                      nop
   607 000002F2 415A                    pop r10
   608 000002F4 415F                    pop r15
   609 000002F6 415E                    pop r14
   610 000002F8 415D                    pop r13
   611 000002FA 415C                    pop r12
   612                                 
   613 000002FC C3                      ret
   614                                 
   615                                 
   616                                 
