     1                                 %line 1+1 ast9procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 [section .data]
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 TRUE equ 1
    35                                 FALSE equ 0
    36                                 
    37                                 EXIT_SUCCESS equ 0
    38                                 
    39                                 STDIN equ 0
    40                                 STDOUT equ 1
    41                                 STDERR equ 2
    42                                 
    43                                 SYS_read equ 0
    44                                 SYS_write equ 1
    45                                 SYS_open equ 2
    46                                 SYS_close equ 3
    47                                 SYS_fork equ 57
    48                                 SYS_exit equ 60
    49                                 SYS_creat equ 85
    50                                 SYS_time equ 201
    51                                 
    52                                 LF equ 10
    53                                 SPACE equ " "
    54                                 NULL equ 0
    55                                 ESC equ 27
    56                                 
    57                                 
    58                                 
    59                                 
    60                                 SUCCESS equ 0
    61                                 NOSUCCESS equ 1
    62                                 OUTOFRANGEMIN equ 2
    63                                 OUTOFRANGEMAX equ 3
    64                                 INPUTOVERFLOW equ 4
    65                                 ENDOFINPUT equ 5
    66                                 
    67                                 MIN_NUM equ 1
    68                                 MAX_NUM equ 50000
    69                                 
    70                                 BUFFSIZE equ 50
    71                                 
    72                                 
    73                                 
    74                                 
    75                                 
    76                                 
    77                                 [section .text]
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                 
    86                                 
    87                                 
    88                                 
    89                                 
    90                                 
    91                                 
    92                                 
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103                                 
   104                                 
   105                                 
   106                                 [global readSenaryNum]
   107                                 readSenaryNum:
   108                                 
   109                                 
   110                                 
   111                                 
   112                                 
   113                                 
   114                                 
   115                                 
   116                                 
   117                                 
   118                                 
   119                                 
   120                                 
   121                                 
   122                                 
   123 00000000 55                     push rbp
   124 00000001 4889E5                 mov rbp, rsp
   125 00000004 4883ED32               sub rbp, BUFFSIZE
   126 00000008 48FFCD                 dec rbp
   127 0000000B 57                     push rdi
   128 0000000C 52                     push rdx
   129 0000000D 53                     push rbx
   130 0000000E 4154                   push r12
   131 00000010 4153                   push r11
   132 00000012 4156                   push r14
   133 00000014 4157                   push r15
   134 00000016 51                     push rcx
   135 00000017 4155                   push r13
   136                                 
   137                                 
   138 00000019 49C7C400000000         mov r12, 0
   139 00000020 488D5D01               lea rbx, [rbp + 1]
   140 00000024 4989FF                 mov r15, rdi
   141                                 readChars:
   142 00000027 48C7C000000000         mov rax, SYS_read
   143 0000002E 48C7C700000000         mov rdi, STDIN
   144 00000035 488D7500               lea rsi, byte [rbp]
   145 00000039 48C7C201000000         mov rdx, 1
   146 00000040 0F05                   syscall
   147 00000042 8A4500                 mov al, byte [rbp]
   148                                 
   149 00000045 3C0A                   cmp al, LF
   150 00000047 7412                   je readDone
   151                                 
   152 00000049 3C20                   cmp al, SPACE
   153 0000004B 74D8                   je readChars
   154                                 
   155 0000004D 49FFC4                 inc r12
   156 00000050 4983FC32               cmp r12, BUFFSIZE
   157 00000054 73CF                   jae readChars
   158                                 
   159 00000056 8803                   mov byte [rbx], al
   160 00000058 48FFC3                 inc rbx
   161                                 
   162 0000005B EBC8                   jmp readChars
   163                                 readDone:
   164 0000005D C60300                 mov byte [rbx], NULL
   165                                 
   166                                 
   167 00000060 4983FC32               cmp r12, BUFFSIZE
   168 00000064 0F83A1000000           jae lengthExceeded
   169                                 
   170 0000006A 4983FC00               cmp r12, 0
   171 0000006E 0F849E000000           je emptyInput
   172                                 
   173 00000074 488D5D01               lea rbx, [rbp + 1]
   174 00000078 803B30                 cmp byte [rbx], 48
   175 0000007B 7400                   je ignoreLeadingZero
   176 0000007D EB0F                   jmp skip
   177                                 ignoreLeadingZero:
   178 0000007F 8A03                   mov al, byte [rbx]
   179 00000081 3C30                   cmp al, 48
   180 00000083 7509                   jne skip
   181 00000085 48FFC3                 inc rbx
   182 00000088 49FFCC                 dec r12
   183 0000008B 803B00                 cmp byte [rbx], NULL
   184 0000008E 75ED                   jne ignoreLeadingZero
   185                                 skip:
   186                                 
   187 00000090 49C7C300000000         mov r11, 0
   188 00000097 4D89E5                 mov r13, r12
   189 0000009A 49FFCD                 dec r13
   190 0000009D 48C7C106000000         mov rcx, 6
   191 000000A4 49C7C600000000         mov r14, 0
   192                                 
   193                                 toDigit:
   194 000000AB 420FB6041B             movzx eax, byte [rbx + r11]
   195                                 
   196 000000B0 3C30                   cmp al, 48
   197 000000B2 7254                   jb invalidNumber
   198                                 
   199 000000B4 3C36                   cmp al, 54
   200 000000B6 7350                   jae invalidNumber
   201 000000B8 83E830                 sub eax, 48
   202                                 
   203 000000BB 4983FD00               cmp r13, 0
   204 000000BF 7500                   jne exp
   205 000000C1 EB09                   jmp continue3
   206                                 
   207                                 exp:
   208 000000C3 F7E1                   mul ecx
   209 000000C5 49FFCD                 dec r13
   210 000000C8 4983FD00               cmp r13, 0
   211 000000CC 75F3                   jne exp
   212                                 
   213                                 continue3:
   214 000000CE 4101C6                 add r14d, eax
   215                                 
   216 000000D1 49FFC3                 inc r11
   217 000000D4 49FFCC                 dec r12
   218 000000D7 4D89E5                 mov r13, r12
   219 000000DA 49FFCD                 dec r13
   220 000000DD 4983FC00               cmp r12, 0
   221 000000E1 75C6                   jne toDigit
   222                                 
   223 000000E3 4983FE01               cmp r14, MIN_NUM
   224 000000E7 7211                   jb belowMin
   225                                 
   226 000000E9 4981FE50C30000         cmp r14, MAX_NUM
   227 000000F0 730F                   jae aboveMax
   228                                 
   229                                 
   230 000000F2 458937                 mov dword [r15], r14d
   231 000000F5 B800000000             mov eax, 0
   232 000000FA EB21                   jmp done
   233                                 
   234                                 belowMin:
   235 000000FC B802000000             mov eax, 2
   236 00000101 EB1A                   jmp done
   237                                 
   238                                 aboveMax:
   239 00000103 B803000000             mov eax, 3
   240 00000108 EB13                   jmp done
   241                                 
   242                                 invalidNumber:
   243 0000010A B801000000             mov eax, 1
   244 0000010F EB0C                   jmp done
   245                                 
   246                                 lengthExceeded:
   247 00000111 B804000000             mov eax, 4
   248 00000116 EB05                   jmp done
   249                                 
   250                                 emptyInput:
   251 00000118 B805000000             mov eax, 5
   252 0000011D EBFE                   jmp done
   253                                 
   254                                 done:
   255 0000011F 415D                   pop r13
   256 00000121 59                     pop rcx
   257 00000122 415F                   pop r15
   258 00000124 415E                   pop r14
   259 00000126 415B                   pop r11
   260 00000128 415C                   pop r12
   261 0000012A 5B                     pop rbx
   262 0000012B 5A                     pop rdx
   263 0000012C 5F                     pop rdi
   264 0000012D 5D                     pop rbp
   265                                 
   266 0000012E C3                     ret
   267                                 
   268                                 
   269                                 
   270                                 
   271                                 
   272                                 
   273                                 
   274                                 
   275                                 
   276                                 
   277                                 
   278                                 
   279                                 
   280                                 
   281                                 
   282                                 
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 
   293                                 
   294                                 
   295                                 
   296                                 
   297                                 
   298                                 
   299                                 
   300                                 
   301                                 
   302                                 
   303                                 
   304                                 
   305                                 
   306                                 
   307                                 
   308                                 [global oddEvenSort]
   309                                 oddEvenSort:
   310                                 
   311 0000012F 4154                   push r12
   312 00000131 4155                   push r13
   313 00000133 53                     push rbx
   314 00000134 51                     push rcx
   315 00000135 4157                   push r15
   316                                 
   317                                 while:
   318 00000137 41B701                 mov r15b, 1
   319 0000013A 49C7C401000000         mov r12, 1
   320 00000141 4189F5                 mov r13d, esi
   321 00000144 4183ED01               sub r13d, 1
   322                                 
   323                                 forLoop1:
   324 00000148 4539EC                 cmp r12d, r13d
   325 0000014B 731D                   jae nextLoop
   326                                 
   327                                 
   328 0000014D 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   329 00000151 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   330                                 
   331 00000156 39CB                   cmp ebx, ecx
   332 00000158 760A                   jbe continue1
   333                                 
   334 0000015A 42890CA7               mov dword [rdi + r12 * 4], ecx
   335 0000015E 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   336 00000163 41B700                 mov r15b, 0
   337                                 
   338                                 continue1:
   339 00000166 4983C402               add r12, 2
   340 0000016A EBDA                   jmp forLoop1
   341                                 nextLoop:
   342 0000016C 49C7C400000000         mov r12, 0
   343                                 
   344                                 forLoop2:
   345 00000173 4539EC                 cmp r12d, r13d
   346 00000176 731D                   jae whileCondition
   347                                 
   348                                 
   349 00000178 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   350 0000017C 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   351                                 
   352 00000181 39CB                   cmp ebx, ecx
   353 00000183 760A                   jbe continue2
   354                                 
   355 00000185 42890CA7               mov dword [rdi + r12 * 4], ecx
   356 00000189 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   357 0000018E 41B700                 mov r15b, 0
   358                                 
   359                                 continue2:
   360 00000191 4983C402               add r12, 2
   361 00000195 EBDA                   jmp forLoop2
   362                                 whileCondition:
   363 00000197 4180FF00               cmp r15b, 0
   364 0000019B 7498                   je while
   365                                 
   366 0000019D 415F                   pop r15
   367 0000019F 59                     pop rcx
   368 000001A0 5A                     pop rdx
   369 000001A1 415D                   pop r13
   370 000001A3 415C                   pop r12
   371                                 
   372 000001A5 C3                     ret
   373                                 
   374                                 
   375                                 
   376                                 
   377                                 
   378                                 
   379                                 
   380                                 
   381                                 
   382                                 
   383                                 
   384                                 
   385                                 
   386                                 
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 [global listStats]
   403                                 listStats:
   404                                 
   405                                 
   406                                 
   407 000001A6 55                      push rbp
   408 000001A7 4889E5                  mov rbp, rsp
   409 000001AA 4154                    push r12
   410 000001AC 4155                    push r13
   411                                 
   412 000001AE 448B27                  mov r12d, dword [rdi]
   413 000001B1 448922                  mov dword [rdx], r12d
   414 000001B4 448B64B7FC              mov r12d, dword [rdi + ((rsi * 4) - 4)]
   415 000001B9 448921                  mov dword [rcx], r12d
   416                                 
   417 000001BC 49C7C400000000          mov r12, 0
   418 000001C3 49C7C500000000          mov r13, 0
   419                                  sumLoop:
   420 000001CA 46032CA7                add r13d, dword [rdi + r12 * 4]
   421 000001CE 49FFC4                  inc r12
   422 000001D1 4939F4                  cmp r12, rsi
   423 000001D4 72F2                    jb sumLoop
   424 000001D6 458929                  mov dword [r9], r13d
   425                                 
   426 000001D9 4C8B6D10                mov r13, qword [rbp + 16]
   427 000001DD 418B01                  mov eax, dword [r9]
   428 000001E0 99                      cdq
   429 000001E1 F7F6                    div esi
   430 000001E3 49894500                mov qword [r13], rax
   431                                 
   432                                 
   433 000001E7 52                      push rdx
   434 000001E8 89F0                    mov eax, esi
   435 000001EA 99                      cdq
   436 000001EB 49C7C402000000          mov r12, 2
   437 000001F2 49F7F4                  div r12
   438 000001F5 4883FA01                cmp rdx, 1
   439 000001F9 750B                    jne evenLength1
   440                                 
   441 000001FB 4D89C5                  mov r13, r8
   442 000001FE 448B2487                mov r12d, dword [rdi + rax * 4]
   443 00000202 45896500                mov dword [r13], r12d
   444 00000206 EB18                    jmp statsDone
   445                                 
   446                                  evenLength1:
   447 00000208 49C7C400000000          mov r12, 0
   448 0000020F 448B2487                mov r12d, dword [rdi + rax * 4]
   449 00000213 44036487FC              add r12d, dword [rdi + ((rax * 4) - 4)]
   450 00000218 41D1EC                  shr r12d, 1
   451 0000021B 4D89C5                  mov r13, r8
   452 0000021E 45896500                mov dword [r13], r12d
   453                                 
   454                                  statsDone:
   455 00000222 5A                      pop rdx
   456 00000223 415D                    pop r13
   457 00000225 415C                    pop r12
   458 00000227 5D                      pop rbp
   459                                 
   460 00000228 C3                      ret
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 
   466                                 
   467                                 
   468                                 
   469                                 
   470                                 
   471                                 
   472                                 
   473                                 
   474                                 
   475                                 
   476                                 
   477                                 
   478                                 
   479                                 
   480                                 
   481                                 
   482                                 
   483                                 
   484                                 [global estimatedMedian]
   485                                 estimatedMedian:
   486                                 
   487                                 
   488                                 
   489 00000229 52                      push rdx
   490 0000022A 4154                    push r12
   491 0000022C 89F0                    mov eax, esi
   492 0000022E 99                      cdq
   493 0000022F 49C7C402000000          mov r12, 2
   494 00000236 41F7F4                  div r12d
   495 00000239 4883FA01                cmp rdx, 1
   496 0000023D 750A                    jne evenLength2
   497                                 
   498                                 
   499 0000023F 4989F4                  mov r12, rsi
   500 00000242 49D1EC                  shr r12, 1
   501 00000245 428B04A7                mov eax, dword [rdi + r12 * 4]
   502 00000249 EB0F                    jmp medianDone
   503                                 
   504                                  evenLength2:
   505 0000024B 4989F4                  mov r12, rsi
   506 0000024E 49D1EC                  shr r12, 1
   507 00000251 428B04A7                mov eax, dword [rdi + r12 * 4]
   508 00000255 420344A7FC              add eax, dword [rdi + ((r12 * 4) - 4)]
   509 0000025A D1E8                    shr eax, 1
   510                                 
   511                                  medianDone:
   512 0000025C 415C                    pop r12
   513 0000025E 5A                      pop rdx
   514                                 
   515 0000025F C3                      ret
   516                                 
   517                                 
   518                                 
   519                                 
   520                                 
   521                                 
   522                                 
   523                                 
   524                                 
   525                                 
   526                                 
   527                                 
   528                                 
   529                                 
   530                                 
   531                                 
   532                                 
   533                                 
   534                                 
   535                                 
   536                                 
   537                                 
   538                                 
   539                                 
   540                                 
   541                                 
   542                                 
   543                                 
   544                                 [global estimatedSkew]
   545                                 estimatedSkew:
   546                                 
   547                                 
   548                                 
   549                                 
   550                                 
   551 00000260 4154                    push r12
   552 00000262 4155                    push r13
   553 00000264 4156                    push r14
   554 00000266 4157                    push r15
   555 00000268 4152                    push r10
   556                                 
   557 0000026A 49C7C400000000          mov r12, 0
   558 00000271 4989F6                  mov r14, rsi
   559 00000274 49FFCE                  dec r14
   560 00000277 49C7C700000000          mov r15, 0
   561 0000027E 49C7C200000000          mov r10, 0
   562                                 
   563                                  skewLoop:
   564                                 
   565 00000285 428B04A7                mov eax, dword [rdi + r12 * 4]
   566 00000289 29D0                    sub eax, edx
   567 0000028B 52                      push rdx
   568 0000028C 99                      cdq
   569 0000028D F7E0                    mul eax
   570 0000028F 4189C7                  mov r15d, eax
   571 00000292 4D89FD                  mov r13, r15
   572 00000295 4D01EA                  add r10, r13
   573 00000298 5A                      pop rdx
   574 00000299 49FFC4                  inc r12
   575 0000029C 4D39F4                  cmp r12, r14
   576 0000029F 76E2                    jbe skewLoop
   577                                 
   578 000002A1 90                      nop
   579 000002A2 49C7C403000000          mov r12, 3
   580 000002A9 89F0                    mov eax, esi
   581 000002AB 41F7E4                  mul r12d
   582 000002AE 4989C4                  mov r12, rax
   583 000002B1 4C89D0                  mov rax, r10
   584 000002B4 4899                    cqo
   585 000002B6 49F7F4                  div r12
   586 000002B9 90                      nop
   587 000002BA 415A                    pop r10
   588 000002BC 415F                    pop r15
   589 000002BE 415E                    pop r14
   590 000002C0 415D                    pop r13
   591 000002C2 415C                    pop r12
   592                                 
   593 000002C4 C3                      ret
   594                                 
   595                                 
   596                                 
