     1                                 %line 1+1 ast9procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 [section .data]
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 TRUE equ 1
    35                                 FALSE equ 0
    36                                 
    37                                 EXIT_SUCCESS equ 0
    38                                 
    39                                 STDIN equ 0
    40                                 STDOUT equ 1
    41                                 STDERR equ 2
    42                                 
    43                                 SYS_read equ 0
    44                                 SYS_write equ 1
    45                                 SYS_open equ 2
    46                                 SYS_close equ 3
    47                                 SYS_fork equ 57
    48                                 SYS_exit equ 60
    49                                 SYS_creat equ 85
    50                                 SYS_time equ 201
    51                                 
    52                                 LF equ 10
    53                                 SPACE equ " "
    54                                 NULL equ 0
    55                                 ESC equ 27
    56                                 
    57                                 
    58                                 
    59                                 
    60                                 SUCCESS equ 0
    61                                 NOSUCCESS equ 1
    62                                 OUTOFRANGEMIN equ 2
    63                                 OUTOFRANGEMAX equ 3
    64                                 INPUTOVERFLOW equ 4
    65                                 ENDOFINPUT equ 5
    66                                 
    67                                 MIN_NUM equ 1
    68                                 MAX_NUM equ 50000
    69                                 
    70                                 BUFFSIZE equ 50
    71                                 
    72                                 
    73                                 
    74                                 
    75                                 
    76                                 
    77                                 [section .text]
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                 
    86                                 
    87                                 
    88                                 
    89                                 
    90                                 
    91                                 
    92                                 
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103                                 
   104                                 
   105                                 
   106                                 [global readSenaryNum]
   107                                 readSenaryNum:
   108                                 
   109                                 
   110                                 
   111                                 
   112                                 
   113                                 
   114                                 
   115                                 
   116                                 
   117                                 
   118                                 
   119                                 
   120                                 
   121                                 
   122                                 
   123 00000000 55                     push rbp
   124 00000001 4889E5                 mov rbp, rsp
   125 00000004 C6451000               mov byte [rbp + 16], 0
   126 00000008 57                     push rdi
   127 00000009 56                     push rsi
   128 0000000A 52                     push rdx
   129 0000000B 53                     push rbx
   130 0000000C 4154                   push r12
   131 0000000E 4153                   push r11
   132 00000010 4156                   push r14
   133 00000012 51                     push rcx
   134                                 
   135 00000013 49C7C400000000         mov r12, 0
   136 0000001A 4889FB                 mov rbx, rdi
   137                                 readChars:
   138 0000001D 48C7C000000000         mov rax, SYS_read
   139 00000024 48C7C700000000         mov rdi, STDIN
   140 0000002B 488D7508               lea rsi, byte [rbp + 8]
   141 0000002F 48C7C201000000         mov rdx, 1
   142 00000036 0F05                   syscall
   143                                 
   144 00000038 8A4508                 mov al, byte [rbp + 8]
   145                                 
   146 0000003B 3C0A                   cmp al, LF
   147 0000003D 740D                   je readDone
   148                                 
   149 0000003F 3C20                   cmp al, SPACE
   150 00000041 74D8                   je readChars
   151                                 
   152 00000043 49FFC4                 inc r12
   153 00000046 4983FC32               cmp r12, BUFFSIZE
   154 0000004A 73CF                   jae readChars
   155                                 
   156 0000004C EBCD                   jmp readChars
   157                                 readDone:
   158 0000004E C60300                 mov byte [rbx], NULL
   159                                 
   160 00000051 4983FC32               cmp r12, BUFFSIZE
   161 00000055 0F8780000000           ja overFlow
   162                                 
   163 0000005B 4983FC00               cmp r12, 0
   164 0000005F 7470                   je empty
   165                                 
   166 00000061 49C7C300000000         mov r11, 0
   167 00000068 4C89E2                 mov rdx, r12
   168 0000006B 48FFCA                 dec rdx
   169 0000006E 48C7C10A000000         mov rcx, 10
   170 00000075 49C7C600000000         mov r14, 0
   171                                 
   172                                 toDigit:
   173 0000007C 420FB6041B             movzx eax, byte [rbx + r11]
   174                                 
   175 00000081 3C30                   cmp al, 48
   176 00000083 7253                   jb invalidNumber
   177                                 
   178 00000085 3C36                   cmp al, 54
   179 00000087 734F                   jae invalidNumber
   180 00000089 83E830                 sub eax, 48
   181                                 
   182 0000008C 4883FA00               cmp rdx, 0
   183 00000090 7500                   jne exp
   184 00000092 EB09                   jmp continue3
   185                                 
   186                                 exp:
   187 00000094 F6E1                   mul cl
   188 00000096 48FFCA                 dec rdx
   189 00000099 4883FA00               cmp rdx, 0
   190 0000009D 75F3                   jne exp
   191                                 
   192                                 continue3:
   193 0000009F 4101C6                 add r14d, eax
   194                                 
   195 000000A2 49FFC3                 inc r11
   196 000000A5 49FFCC                 dec r12
   197 000000A8 4C89E2                 mov rdx, r12
   198 000000AB 48FFCA                 dec rdx
   199 000000AE 4983FC00               cmp r12, 0
   200 000000B2 75C6                   jne toDigit
   201                                 
   202                                 
   203                                 
   204 000000B4 4181FE50C30000         cmp r14d, MAX_NUM
   205 000000BB 770D                   ja aboveMax
   206                                 
   207 000000BD 4183FE01               cmp r14d, MIN_NUM
   208 000000C1 7200                   jb belowMin
   209 000000C3 EB21                   jmp success
   210                                 
   211                                 belowMin:
   212 000000C5 B802000000             mov eax, 2
   213 000000CA EB22                   jmp done
   214                                 
   215                                 aboveMax:
   216 000000CC B803000000             mov eax, 3
   217 000000D1 EB1B                   jmp done
   218                                 
   219                                 empty:
   220 000000D3 B805000000             mov eax, 5
   221 000000D8 EB14                   jmp done
   222                                 
   223                                 invalidNumber:
   224 000000DA B801000000             mov eax, 1
   225 000000DF EB0D                   jmp done
   226                                 
   227                                 overFlow:
   228 000000E1 B804000000             mov eax, 4
   229 000000E6 EB06                   jmp done
   230                                 
   231                                 success:
   232 000000E8 B800000000             mov eax, 0
   233 000000ED 4C8933                 mov qword [rbx], r14
   234                                 
   235                                 done:
   236 000000F0 59                     pop rcx
   237 000000F1 415E                   pop r14
   238 000000F3 415B                   pop r11
   239 000000F5 415C                   pop r12
   240 000000F7 5B                     pop rbx
   241 000000F8 5A                     pop rdx
   242 000000F9 5E                     pop rsi
   243 000000FA 5F                     pop rdi
   244                                 
   245                                 
   246 000000FB C3                     ret
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 
   252                                 
   253                                 
   254                                 
   255                                 
   256                                 
   257                                 
   258                                 
   259                                 
   260                                 
   261                                 
   262                                 
   263                                 
   264                                 
   265                                 
   266                                 
   267                                 
   268                                 
   269                                 
   270                                 
   271                                 
   272                                 
   273                                 
   274                                 
   275                                 
   276                                 
   277                                 
   278                                 
   279                                 
   280                                 
   281                                 
   282                                 
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 [global oddEvenSort]
   290                                 oddEvenSort:
   291                                 
   292 000000FC 4154                   push r12
   293 000000FE 4155                   push r13
   294 00000100 53                     push rbx
   295 00000101 51                     push rcx
   296 00000102 4157                   push r15
   297                                 
   298                                 while:
   299 00000104 41B701                 mov r15b, 1
   300 00000107 49C7C401000000         mov r12, 1
   301 0000010E 4189F5                 mov r13d, esi
   302 00000111 4183ED01               sub r13d, 1
   303                                 
   304                                 forLoop1:
   305 00000115 4539EC                 cmp r12d, r13d
   306 00000118 731D                   jae nextLoop
   307                                 
   308                                 
   309 0000011A 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   310 0000011E 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   311                                 
   312 00000123 39CB                   cmp ebx, ecx
   313 00000125 760A                   jbe continue1
   314                                 
   315 00000127 42890CA7               mov dword [rdi + r12 * 4], ecx
   316 0000012B 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   317 00000130 41B700                 mov r15b, 0
   318                                 
   319                                 continue1:
   320 00000133 4983C402               add r12, 2
   321 00000137 EBDA                   jmp forLoop1
   322                                 nextLoop:
   323 00000139 49C7C400000000         mov r12, 0
   324                                 
   325                                 forLoop2:
   326 00000140 4539EC                 cmp r12d, r13d
   327 00000143 731D                   jae whileCondition
   328                                 
   329                                 
   330 00000145 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   331 00000149 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   332                                 
   333 0000014E 39CB                   cmp ebx, ecx
   334 00000150 760A                   jbe continue2
   335                                 
   336 00000152 42890CA7               mov dword [rdi + r12 * 4], ecx
   337 00000156 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   338 0000015B 41B700                 mov r15b, 0
   339                                 
   340                                 continue2:
   341 0000015E 4983C402               add r12, 2
   342 00000162 EBDA                   jmp forLoop2
   343                                 whileCondition:
   344 00000164 4180FF00               cmp r15b, 0
   345 00000168 7498                   je while
   346                                 
   347 0000016A 415F                   pop r15
   348 0000016C 59                     pop rcx
   349 0000016D 5A                     pop rdx
   350 0000016E 415D                   pop r13
   351 00000170 415C                   pop r12
   352                                 
   353 00000172 C3                     ret
   354                                 
   355                                 
   356                                 
   357                                 
   358                                 
   359                                 
   360                                 
   361                                 
   362                                 
   363                                 
   364                                 
   365                                 
   366                                 
   367                                 
   368                                 
   369                                 
   370                                 
   371                                 
   372                                 
   373                                 
   374                                 
   375                                 
   376                                 
   377                                 
   378                                 
   379                                 
   380                                 
   381                                 
   382                                 
   383                                 [global listStats]
   384                                 listStats:
   385                                 
   386                                 
   387                                 
   388 00000173 55                      push rbp
   389 00000174 4889E5                  mov rbp, rsp
   390 00000177 4154                    push r12
   391 00000179 4155                    push r13
   392                                 
   393 0000017B 448B27                  mov r12d, dword [rdi]
   394 0000017E 448922                  mov dword [rdx], r12d
   395 00000181 448B64B7FC              mov r12d, dword [rdi + ((rsi * 4) - 4)]
   396 00000186 448921                  mov dword [rcx], r12d
   397                                 
   398 00000189 49C7C400000000          mov r12, 0
   399 00000190 49C7C500000000          mov r13, 0
   400                                  sumLoop:
   401 00000197 46032CA7                add r13d, dword [rdi + r12 * 4]
   402 0000019B 49FFC4                  inc r12
   403 0000019E 4939F4                  cmp r12, rsi
   404 000001A1 72F2                    jb sumLoop
   405 000001A3 458929                  mov dword [r9], r13d
   406                                 
   407 000001A6 4C8B6D10                mov r13, qword [rbp + 16]
   408 000001AA 418B01                  mov eax, dword [r9]
   409 000001AD 99                      cdq
   410 000001AE F7F6                    div esi
   411 000001B0 49894500                mov qword [r13], rax
   412                                 
   413                                 
   414 000001B4 52                      push rdx
   415 000001B5 89F0                    mov eax, esi
   416 000001B7 99                      cdq
   417 000001B8 49C7C402000000          mov r12, 2
   418 000001BF 49F7F4                  div r12
   419 000001C2 4883FA01                cmp rdx, 1
   420 000001C6 750B                    jne evenLength1
   421                                 
   422 000001C8 4D89C5                  mov r13, r8
   423 000001CB 448B2487                mov r12d, dword [rdi + rax * 4]
   424 000001CF 45896500                mov dword [r13], r12d
   425 000001D3 EB18                    jmp statsDone
   426                                 
   427                                  evenLength1:
   428 000001D5 49C7C400000000          mov r12, 0
   429 000001DC 448B2487                mov r12d, dword [rdi + rax * 4]
   430 000001E0 44036487FC              add r12d, dword [rdi + ((rax * 4) - 4)]
   431 000001E5 41D1EC                  shr r12d, 1
   432 000001E8 4D89C5                  mov r13, r8
   433 000001EB 45896500                mov dword [r13], r12d
   434                                 
   435                                  statsDone:
   436 000001EF 5A                      pop rdx
   437 000001F0 415D                    pop r13
   438 000001F2 415C                    pop r12
   439 000001F4 5D                      pop rbp
   440                                 
   441 000001F5 C3                      ret
   442                                 
   443                                 
   444                                 
   445                                 
   446                                 
   447                                 
   448                                 
   449                                 
   450                                 
   451                                 
   452                                 
   453                                 
   454                                 
   455                                 
   456                                 
   457                                 
   458                                 
   459                                 
   460                                 
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 [global estimatedMedian]
   466                                 estimatedMedian:
   467                                 
   468                                 
   469                                 
   470 000001F6 52                      push rdx
   471 000001F7 4154                    push r12
   472 000001F9 89F0                    mov eax, esi
   473 000001FB 99                      cdq
   474 000001FC 49C7C402000000          mov r12, 2
   475 00000203 41F7F4                  div r12d
   476 00000206 4883FA01                cmp rdx, 1
   477 0000020A 750A                    jne evenLength2
   478                                 
   479                                 
   480 0000020C 4989F4                  mov r12, rsi
   481 0000020F 49D1EC                  shr r12, 1
   482 00000212 428B04A7                mov eax, dword [rdi + r12 * 4]
   483 00000216 EB0F                    jmp medianDone
   484                                 
   485                                  evenLength2:
   486 00000218 4989F4                  mov r12, rsi
   487 0000021B 49D1EC                  shr r12, 1
   488 0000021E 428B04A7                mov eax, dword [rdi + r12 * 4]
   489 00000222 420344A7FC              add eax, dword [rdi + ((r12 * 4) - 4)]
   490 00000227 D1E8                    shr eax, 1
   491                                 
   492                                  medianDone:
   493 00000229 415C                    pop r12
   494 0000022B 5A                      pop rdx
   495                                 
   496 0000022C C3                      ret
   497                                 
   498                                 
   499                                 
   500                                 
   501                                 
   502                                 
   503                                 
   504                                 
   505                                 
   506                                 
   507                                 
   508                                 
   509                                 
   510                                 
   511                                 
   512                                 
   513                                 
   514                                 
   515                                 
   516                                 
   517                                 
   518                                 
   519                                 
   520                                 
   521                                 
   522                                 
   523                                 
   524                                 
   525                                 [global estimatedSkew]
   526                                 estimatedSkew:
   527                                 
   528                                 
   529                                 
   530                                 
   531                                 
   532 0000022D 4154                    push r12
   533 0000022F 4155                    push r13
   534 00000231 4156                    push r14
   535 00000233 4157                    push r15
   536 00000235 4152                    push r10
   537                                 
   538 00000237 49C7C400000000          mov r12, 0
   539 0000023E 4989F6                  mov r14, rsi
   540 00000241 49FFCE                  dec r14
   541 00000244 49C7C700000000          mov r15, 0
   542 0000024B 49C7C200000000          mov r10, 0
   543                                 
   544                                  skewLoop:
   545                                 
   546 00000252 428B04A7                mov eax, dword [rdi + r12 * 4]
   547 00000256 29D0                    sub eax, edx
   548 00000258 52                      push rdx
   549 00000259 99                      cdq
   550 0000025A F7E0                    mul eax
   551 0000025C 4189C7                  mov r15d, eax
   552 0000025F 4D89FD                  mov r13, r15
   553 00000262 4D01EA                  add r10, r13
   554 00000265 5A                      pop rdx
   555 00000266 49FFC4                  inc r12
   556 00000269 4D39F4                  cmp r12, r14
   557 0000026C 76E2                    jbe skewLoop
   558                                 
   559 0000026E 90                      nop
   560 0000026F 49C7C403000000          mov r12, 3
   561 00000276 89F0                    mov eax, esi
   562 00000278 41F7E4                  mul r12d
   563 0000027B 4989C4                  mov r12, rax
   564 0000027E 4C89D0                  mov rax, r10
   565 00000281 4899                    cqo
   566 00000283 49F7F4                  div r12
   567 00000286 90                      nop
   568 00000287 415A                    pop r10
   569 00000289 415F                    pop r15
   570 0000028B 415E                    pop r14
   571 0000028D 415D                    pop r13
   572 0000028F 415C                    pop r12
   573                                 
   574 00000291 C3                      ret
   575                                 
   576                                 
   577                                 
