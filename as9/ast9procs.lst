     1                                 %line 1+1 ast9procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 [section .data]
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 TRUE equ 1
    35                                 FALSE equ 0
    36                                 
    37                                 EXIT_SUCCESS equ 0
    38                                 
    39                                 STDIN equ 0
    40                                 STDOUT equ 1
    41                                 STDERR equ 2
    42                                 
    43                                 SYS_read equ 0
    44                                 SYS_write equ 1
    45                                 SYS_open equ 2
    46                                 SYS_close equ 3
    47                                 SYS_fork equ 57
    48                                 SYS_exit equ 60
    49                                 SYS_creat equ 85
    50                                 SYS_time equ 201
    51                                 
    52                                 LF equ 10
    53                                 SPACE equ " "
    54                                 NULL equ 0
    55                                 ESC equ 27
    56                                 
    57                                 
    58                                 
    59                                 
    60                                 SUCCESS equ 0
    61                                 NOSUCCESS equ 1
    62                                 OUTOFRANGEMIN equ 2
    63                                 OUTOFRANGEMAX equ 3
    64                                 INPUTOVERFLOW equ 4
    65                                 ENDOFINPUT equ 5
    66                                 
    67                                 MIN_NUM equ 1
    68                                 MAX_NUM equ 50000
    69                                 
    70                                 BUFFSIZE equ 3
    71                                 
    72                                 
    73                                 
    74                                 
    75                                 
    76                                 
    77                                 [section .text]
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                 
    86                                 
    87                                 
    88                                 
    89                                 
    90                                 
    91                                 
    92                                 
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103                                 
   104                                 
   105                                 
   106                                 [global readSenaryNum]
   107                                 readSenaryNum:
   108                                 
   109                                 
   110                                 
   111                                 
   112                                 
   113                                 
   114                                 
   115                                 
   116                                 
   117                                 
   118                                 
   119                                 
   120                                 
   121                                 
   122                                 
   123 00000000 55                     push rbp
   124 00000001 4889E5                 mov rbp, rsp
   125 00000004 4883ED03               sub rbp, BUFFSIZE
   126 00000008 48FFCD                 dec rbp
   127 0000000B 57                     push rdi
   128 0000000C 52                     push rdx
   129 0000000D 53                     push rbx
   130 0000000E 4154                   push r12
   131 00000010 4153                   push r11
   132 00000012 4156                   push r14
   133 00000014 51                     push rcx
   134                                 
   135 00000015 488D5D01               lea rbx, byte [rbp + 1]
   136                                 
   137 00000019 49C7C400000000         mov r12, 0
   138 00000020 49C7C300000000         mov r11, 0
   139                                 readChars:
   140 00000027 48C7C000000000         mov rax, SYS_read
   141 0000002E 48C7C700000000         mov rdi, STDIN
   142 00000035 488D7500               lea rsi, byte [rbp]
   143 00000039 48C7C201000000         mov rdx, 1
   144 00000040 0F05                   syscall
   145 00000042 8A4500                 mov al, byte [rbp]
   146                                 
   147 00000045 3C0A                   cmp al, LF
   148 00000047 7414                   je readDone
   149                                 
   150 00000049 3C20                   cmp al, SPACE
   151 0000004B 74D8                   je readChars
   152                                 
   153 0000004D 49FFC4                 inc r12
   154 00000050 4983FC04               cmp r12, BUFFSIZE + 1
   155 00000054 73CF                   jae readChars
   156                                 
   157 00000056 4288041B               mov byte [rbx + r11], al
   158 0000005A 49FFC3                 inc r11
   159                                 
   160 0000005D EBC6                   jmp readChars
   161                                 readDone:
   162                                 
   163                                 
   164 0000005F 4983FC04               cmp r12, BUFFSIZE + 1
   165 00000063 0F87B3000000           ja lengthExceeded
   166                                 
   167 00000069 4983FC00               cmp r12, 0
   168 0000006D 0F84B0000000           je emptyInput
   169                                 
   170 00000073 42C6041B00             mov byte [rbx + r11], NULL
   171                                 
   172                                 
   173                                 
   174                                 
   175                                 
   176                                 
   177                                 
   178                                 
   179                                 
   180                                 
   181                                 
   182 00000078 49C7C300000000         mov r11, 0
   183 0000007F 803B30                 cmp byte [rbx], 48
   184 00000082 7400                   je ignoreLeadingZero
   185 00000084 EB1C                   jmp skip
   186                                 ignoreLeadingZero:
   187 00000086 49C7C300000000         mov r11, 0
   188 0000008D 49C7C600000000         mov r14, 0
   189                                 findZero:
   190 00000094 428A041B               mov al, byte [rbx + r11]
   191 00000098 3C30                   cmp al, 48
   192 0000009A 7506                   jne skip
   193 0000009C 49FFC3                 inc r11
   194 0000009F 4D39E3                 cmp r11, r12
   195 000000A2 75EE                   jne findZero
   196                                 skip:
   197 000000A4 4D29DC                 sub r12, r11
   198                                 
   199 000000A7 4C89E2                 mov rdx, r12
   200 000000AA 48FFCA                 dec rdx
   201 000000AD 48C7C106000000         mov rcx, 6
   202 000000B4 49C7C600000000         mov r14, 0
   203                                 
   204                                 toDigit:
   205 000000BB 420FB6441D00           movzx eax, byte [rbp + r11]
   206                                 
   207 000000C1 3C30                   cmp al, 48
   208 000000C3 7254                   jb invalidNumber
   209                                 
   210 000000C5 3C36                   cmp al, 54
   211 000000C7 7350                   jae invalidNumber
   212 000000C9 83E830                 sub eax, 48
   213                                 
   214 000000CC 4883FA00               cmp rdx, 0
   215 000000D0 7500                   jne exp
   216 000000D2 EB09                   jmp continue3
   217                                 
   218                                 exp:
   219 000000D4 F6E1                   mul cl
   220 000000D6 48FFCA                 dec rdx
   221 000000D9 4883FA00               cmp rdx, 0
   222 000000DD 75F3                   jne exp
   223                                 
   224                                 continue3:
   225 000000DF 4101C6                 add r14d, eax
   226                                 
   227 000000E2 49FFC3                 inc r11
   228 000000E5 49FFCC                 dec r12
   229 000000E8 4C89E2                 mov rdx, r12
   230 000000EB 48FFCA                 dec rdx
   231 000000EE 4983FC00               cmp r12, 0
   232 000000F2 75C5                   jne toDigit
   233                                 
   234 000000F4 4983FE01               cmp r14, MIN_NUM
   235 000000F8 7211                   jb belowMin
   236                                 
   237 000000FA 4981FE50C30000         cmp r14, MAX_NUM
   238 00000101 730F                   jae aboveMax
   239                                 
   240                                 
   241 00000103 448937                 mov dword [rdi], r14d
   242 00000106 B800000000             mov eax, 0
   243 0000010B EB21                   jmp done
   244                                 
   245                                 belowMin:
   246 0000010D B802000000             mov eax, 2
   247 00000112 EB1A                   jmp done
   248                                 
   249                                 aboveMax:
   250 00000114 B803000000             mov eax, 3
   251 00000119 EB13                   jmp done
   252                                 
   253                                 invalidNumber:
   254 0000011B B801000000             mov eax, 1
   255 00000120 EB0C                   jmp done
   256                                 
   257                                 lengthExceeded:
   258 00000122 B804000000             mov eax, 4
   259 00000127 EB05                   jmp done
   260                                 
   261                                 emptyInput:
   262 00000129 B805000000             mov eax, 5
   263 0000012E EBFE                   jmp done
   264                                 
   265                                 done:
   266 00000130 59                     pop rcx
   267 00000131 415E                   pop r14
   268 00000133 415B                   pop r11
   269 00000135 415C                   pop r12
   270 00000137 5B                     pop rbx
   271 00000138 5A                     pop rdx
   272 00000139 5F                     pop rdi
   273 0000013A 5D                     pop rbp
   274                                 
   275 0000013B C3                     ret
   276                                 
   277                                 
   278                                 
   279                                 
   280                                 
   281                                 
   282                                 
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 
   293                                 
   294                                 
   295                                 
   296                                 
   297                                 
   298                                 
   299                                 
   300                                 
   301                                 
   302                                 
   303                                 
   304                                 
   305                                 
   306                                 
   307                                 
   308                                 
   309                                 
   310                                 
   311                                 
   312                                 
   313                                 
   314                                 
   315                                 
   316                                 
   317                                 [global oddEvenSort]
   318                                 oddEvenSort:
   319                                 
   320 0000013C 4154                   push r12
   321 0000013E 4155                   push r13
   322 00000140 53                     push rbx
   323 00000141 51                     push rcx
   324 00000142 4157                   push r15
   325                                 
   326                                 while:
   327 00000144 41B701                 mov r15b, 1
   328 00000147 49C7C401000000         mov r12, 1
   329 0000014E 4189F5                 mov r13d, esi
   330 00000151 4183ED01               sub r13d, 1
   331                                 
   332                                 forLoop1:
   333 00000155 4539EC                 cmp r12d, r13d
   334 00000158 731D                   jae nextLoop
   335                                 
   336                                 
   337 0000015A 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   338 0000015E 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   339                                 
   340 00000163 39CB                   cmp ebx, ecx
   341 00000165 760A                   jbe continue1
   342                                 
   343 00000167 42890CA7               mov dword [rdi + r12 * 4], ecx
   344 0000016B 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   345 00000170 41B700                 mov r15b, 0
   346                                 
   347                                 continue1:
   348 00000173 4983C402               add r12, 2
   349 00000177 EBDA                   jmp forLoop1
   350                                 nextLoop:
   351 00000179 49C7C400000000         mov r12, 0
   352                                 
   353                                 forLoop2:
   354 00000180 4539EC                 cmp r12d, r13d
   355 00000183 731D                   jae whileCondition
   356                                 
   357                                 
   358 00000185 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   359 00000189 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   360                                 
   361 0000018E 39CB                   cmp ebx, ecx
   362 00000190 760A                   jbe continue2
   363                                 
   364 00000192 42890CA7               mov dword [rdi + r12 * 4], ecx
   365 00000196 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   366 0000019B 41B700                 mov r15b, 0
   367                                 
   368                                 continue2:
   369 0000019E 4983C402               add r12, 2
   370 000001A2 EBDA                   jmp forLoop2
   371                                 whileCondition:
   372 000001A4 4180FF00               cmp r15b, 0
   373 000001A8 7498                   je while
   374                                 
   375 000001AA 415F                   pop r15
   376 000001AC 59                     pop rcx
   377 000001AD 5A                     pop rdx
   378 000001AE 415D                   pop r13
   379 000001B0 415C                   pop r12
   380                                 
   381 000001B2 C3                     ret
   382                                 
   383                                 
   384                                 
   385                                 
   386                                 
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 
   404                                 
   405                                 
   406                                 
   407                                 
   408                                 
   409                                 
   410                                 
   411                                 [global listStats]
   412                                 listStats:
   413                                 
   414                                 
   415                                 
   416 000001B3 55                      push rbp
   417 000001B4 4889E5                  mov rbp, rsp
   418 000001B7 4154                    push r12
   419 000001B9 4155                    push r13
   420                                 
   421 000001BB 448B27                  mov r12d, dword [rdi]
   422 000001BE 448922                  mov dword [rdx], r12d
   423 000001C1 448B64B7FC              mov r12d, dword [rdi + ((rsi * 4) - 4)]
   424 000001C6 448921                  mov dword [rcx], r12d
   425                                 
   426 000001C9 49C7C400000000          mov r12, 0
   427 000001D0 49C7C500000000          mov r13, 0
   428                                  sumLoop:
   429 000001D7 46032CA7                add r13d, dword [rdi + r12 * 4]
   430 000001DB 49FFC4                  inc r12
   431 000001DE 4939F4                  cmp r12, rsi
   432 000001E1 72F2                    jb sumLoop
   433 000001E3 458929                  mov dword [r9], r13d
   434                                 
   435 000001E6 4C8B6D10                mov r13, qword [rbp + 16]
   436 000001EA 418B01                  mov eax, dword [r9]
   437 000001ED 99                      cdq
   438 000001EE F7F6                    div esi
   439 000001F0 49894500                mov qword [r13], rax
   440                                 
   441                                 
   442 000001F4 52                      push rdx
   443 000001F5 89F0                    mov eax, esi
   444 000001F7 99                      cdq
   445 000001F8 49C7C402000000          mov r12, 2
   446 000001FF 49F7F4                  div r12
   447 00000202 4883FA01                cmp rdx, 1
   448 00000206 750B                    jne evenLength1
   449                                 
   450 00000208 4D89C5                  mov r13, r8
   451 0000020B 448B2487                mov r12d, dword [rdi + rax * 4]
   452 0000020F 45896500                mov dword [r13], r12d
   453 00000213 EB18                    jmp statsDone
   454                                 
   455                                  evenLength1:
   456 00000215 49C7C400000000          mov r12, 0
   457 0000021C 448B2487                mov r12d, dword [rdi + rax * 4]
   458 00000220 44036487FC              add r12d, dword [rdi + ((rax * 4) - 4)]
   459 00000225 41D1EC                  shr r12d, 1
   460 00000228 4D89C5                  mov r13, r8
   461 0000022B 45896500                mov dword [r13], r12d
   462                                 
   463                                  statsDone:
   464 0000022F 5A                      pop rdx
   465 00000230 415D                    pop r13
   466 00000232 415C                    pop r12
   467 00000234 5D                      pop rbp
   468                                 
   469 00000235 C3                      ret
   470                                 
   471                                 
   472                                 
   473                                 
   474                                 
   475                                 
   476                                 
   477                                 
   478                                 
   479                                 
   480                                 
   481                                 
   482                                 
   483                                 
   484                                 
   485                                 
   486                                 
   487                                 
   488                                 
   489                                 
   490                                 
   491                                 
   492                                 
   493                                 [global estimatedMedian]
   494                                 estimatedMedian:
   495                                 
   496                                 
   497                                 
   498 00000236 52                      push rdx
   499 00000237 4154                    push r12
   500 00000239 89F0                    mov eax, esi
   501 0000023B 99                      cdq
   502 0000023C 49C7C402000000          mov r12, 2
   503 00000243 41F7F4                  div r12d
   504 00000246 4883FA01                cmp rdx, 1
   505 0000024A 750A                    jne evenLength2
   506                                 
   507                                 
   508 0000024C 4989F4                  mov r12, rsi
   509 0000024F 49D1EC                  shr r12, 1
   510 00000252 428B04A7                mov eax, dword [rdi + r12 * 4]
   511 00000256 EB0F                    jmp medianDone
   512                                 
   513                                  evenLength2:
   514 00000258 4989F4                  mov r12, rsi
   515 0000025B 49D1EC                  shr r12, 1
   516 0000025E 428B04A7                mov eax, dword [rdi + r12 * 4]
   517 00000262 420344A7FC              add eax, dword [rdi + ((r12 * 4) - 4)]
   518 00000267 D1E8                    shr eax, 1
   519                                 
   520                                  medianDone:
   521 00000269 415C                    pop r12
   522 0000026B 5A                      pop rdx
   523                                 
   524 0000026C C3                      ret
   525                                 
   526                                 
   527                                 
   528                                 
   529                                 
   530                                 
   531                                 
   532                                 
   533                                 
   534                                 
   535                                 
   536                                 
   537                                 
   538                                 
   539                                 
   540                                 
   541                                 
   542                                 
   543                                 
   544                                 
   545                                 
   546                                 
   547                                 
   548                                 
   549                                 
   550                                 
   551                                 
   552                                 
   553                                 [global estimatedSkew]
   554                                 estimatedSkew:
   555                                 
   556                                 
   557                                 
   558                                 
   559                                 
   560 0000026D 4154                    push r12
   561 0000026F 4155                    push r13
   562 00000271 4156                    push r14
   563 00000273 4157                    push r15
   564 00000275 4152                    push r10
   565                                 
   566 00000277 49C7C400000000          mov r12, 0
   567 0000027E 4989F6                  mov r14, rsi
   568 00000281 49FFCE                  dec r14
   569 00000284 49C7C700000000          mov r15, 0
   570 0000028B 49C7C200000000          mov r10, 0
   571                                 
   572                                  skewLoop:
   573                                 
   574 00000292 428B04A7                mov eax, dword [rdi + r12 * 4]
   575 00000296 29D0                    sub eax, edx
   576 00000298 52                      push rdx
   577 00000299 99                      cdq
   578 0000029A F7E0                    mul eax
   579 0000029C 4189C7                  mov r15d, eax
   580 0000029F 4D89FD                  mov r13, r15
   581 000002A2 4D01EA                  add r10, r13
   582 000002A5 5A                      pop rdx
   583 000002A6 49FFC4                  inc r12
   584 000002A9 4D39F4                  cmp r12, r14
   585 000002AC 76E2                    jbe skewLoop
   586                                 
   587 000002AE 90                      nop
   588 000002AF 49C7C403000000          mov r12, 3
   589 000002B6 89F0                    mov eax, esi
   590 000002B8 41F7E4                  mul r12d
   591 000002BB 4989C4                  mov r12, rax
   592 000002BE 4C89D0                  mov rax, r10
   593 000002C1 4899                    cqo
   594 000002C3 49F7F4                  div r12
   595 000002C6 90                      nop
   596 000002C7 415A                    pop r10
   597 000002C9 415F                    pop r15
   598 000002CB 415E                    pop r14
   599 000002CD 415D                    pop r13
   600 000002CF 415C                    pop r12
   601                                 
   602 000002D1 C3                      ret
   603                                 
   604                                 
   605                                 
