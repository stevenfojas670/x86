     1                                 %line 1+1 ast9procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 [section .data]
    30                                 
    31                                 
    32                                 
    33                                 
    34                                 TRUE equ 1
    35                                 FALSE equ 0
    36                                 
    37                                 EXIT_SUCCESS equ 0
    38                                 
    39                                 STDIN equ 0
    40                                 STDOUT equ 1
    41                                 STDERR equ 2
    42                                 
    43                                 SYS_read equ 0
    44                                 SYS_write equ 1
    45                                 SYS_open equ 2
    46                                 SYS_close equ 3
    47                                 SYS_fork equ 57
    48                                 SYS_exit equ 60
    49                                 SYS_creat equ 85
    50                                 SYS_time equ 201
    51                                 
    52                                 LF equ 10
    53                                 SPACE equ " "
    54                                 NULL equ 0
    55                                 ESC equ 27
    56                                 
    57                                 
    58                                 
    59                                 
    60                                 SUCCESS equ 0
    61                                 NOSUCCESS equ 1
    62                                 OUTOFRANGEMIN equ 2
    63                                 OUTOFRANGEMAX equ 3
    64                                 INPUTOVERFLOW equ 4
    65                                 ENDOFINPUT equ 5
    66                                 
    67                                 MIN_NUM equ 1
    68                                 MAX_NUM equ 50000
    69                                 
    70                                 BUFFSIZE equ 50
    71                                 
    72                                 
    73                                 
    74                                 
    75                                 
    76                                 
    77                                 [section .text]
    78                                 
    79                                 
    80                                 
    81                                 
    82                                 
    83                                 
    84                                 
    85                                 
    86                                 
    87                                 
    88                                 
    89                                 
    90                                 
    91                                 
    92                                 
    93                                 
    94                                 
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 
   102                                 
   103                                 
   104                                 
   105                                 
   106                                 [global readSenaryNum]
   107                                 readSenaryNum:
   108                                 
   109                                 
   110                                 
   111                                 
   112                                 
   113                                 
   114                                 
   115                                 
   116                                 
   117                                 
   118                                 
   119                                 
   120                                 
   121                                 
   122                                 
   123 00000000 57                     push rdi
   124 00000001 56                     push rsi
   125 00000002 52                     push rdx
   126 00000003 53                     push rbx
   127 00000004 4154                   push r12
   128 00000006 4153                   push r11
   129 00000008 4156                   push r14
   130 0000000A 51                     push rcx
   131                                 
   132 0000000B 49C7C400000000         mov r12, 0
   133 00000012 4889FB                 mov rbx, rdi
   134                                 readChars:
   135 00000015 48C7C000000000         mov rax, SYS_read
   136 0000001C 48C7C700000000         mov rdi, STDIN
   137 00000023 488D33                 lea rsi, byte [rbx]
   138 00000026 48C7C201000000         mov rdx, 1
   139 0000002D 0F05                   syscall
   140                                 
   141 0000002F 8A03                   mov al, byte [rbx]
   142                                 
   143 00000031 3C0A                   cmp al, LF
   144 00000033 7412                   je readDone
   145                                 
   146 00000035 3C20                   cmp al, SPACE
   147 00000037 74DA                   je readChars
   148                                 
   149 00000039 49FFC4                 inc r12
   150 0000003C 4983FC32               cmp r12, BUFFSIZE
   151 00000040 73D1                   jae readChars
   152                                 
   153 00000042 8803                   mov byte [rbx], al
   154 00000044 48FFC3                 inc rbx
   155                                 
   156 00000047 EBCA                   jmp readChars
   157                                 readDone:
   158                                 
   159 00000049 4983FC31               cmp r12, BUFFSIZE - 1
   160 0000004D 0F87B0000000           ja overFlow
   161                                 
   162 00000053 4983FC00               cmp r12, 0
   163 00000057 0F8498000000           je empty
   164                                 
   165 0000005D 49C7C300000000         mov r11, 0
   166                                 returnNewNumber:
   167 00000064 48FFCB                 dec rbx
   168 00000067 49FFC3                 inc r11
   169 0000006A 4D39E3                 cmp r11, r12
   170 0000006D 72F3                   jb returnNewNumber
   171                                 
   172                                 
   173                                 
   174 0000006F 48C7C000000000         mov rax, 0
   175 00000076 49C7C300000000         mov r11, 0
   176                                 stringLoop:
   177 0000007D 428A041B               mov al, byte [rbx + r11]
   178 00000081 49FFC3                 inc r11
   179 00000084 4D39E3                 cmp r11, r12
   180 00000087 72F2                   jb stringLoop
   181                                 
   182                                 
   183                                 
   184 00000089 49C7C300000000         mov r11, 0
   185 00000090 4C89E2                 mov rdx, r12
   186 00000093 48FFCA                 dec rdx
   187 00000096 48C7C10A000000         mov rcx, 10
   188 0000009D 49C7C600000000         mov r14, 0
   189                                 
   190                                 toDigit:
   191 000000A4 420FB6041B             movzx eax, byte [rbx + r11]
   192                                 
   193 000000A9 3C30                   cmp al, 48
   194 000000AB 7253                   jb invalidNumber
   195                                 
   196 000000AD 3C36                   cmp al, 54
   197 000000AF 734F                   jae invalidNumber
   198 000000B1 83E830                 sub eax, 48
   199                                 
   200 000000B4 4883FA00               cmp rdx, 0
   201 000000B8 7500                   jne exp
   202 000000BA EB09                   jmp continue3
   203                                 
   204                                 exp:
   205 000000BC F6E1                   mul cl
   206 000000BE 48FFCA                 dec rdx
   207 000000C1 4883FA00               cmp rdx, 0
   208 000000C5 75F3                   jne exp
   209                                 
   210                                 continue3:
   211 000000C7 4101C6                 add r14d, eax
   212                                 
   213 000000CA 49FFC3                 inc r11
   214 000000CD 49FFCC                 dec r12
   215 000000D0 4C89E2                 mov rdx, r12
   216 000000D3 48FFCA                 dec rdx
   217 000000D6 4983FC00               cmp r12, 0
   218 000000DA 75C6                   jne toDigit
   219                                 
   220                                 
   221                                 
   222 000000DC 4181FE50C30000         cmp r14d, MAX_NUM
   223 000000E3 770D                   ja aboveMax
   224                                 
   225 000000E5 4183FE01               cmp r14d, MIN_NUM
   226 000000E9 7200                   jb belowMin
   227 000000EB EB21                   jmp success
   228                                 
   229                                 belowMin:
   230 000000ED B802000000             mov eax, 2
   231 000000F2 EB22                   jmp done
   232                                 
   233                                 aboveMax:
   234 000000F4 B803000000             mov eax, 3
   235 000000F9 EB1B                   jmp done
   236                                 
   237                                 empty:
   238 000000FB B805000000             mov eax, 5
   239 00000100 EB14                   jmp done
   240                                 
   241                                 invalidNumber:
   242 00000102 B801000000             mov eax, 1
   243 00000107 EB0D                   jmp done
   244                                 
   245                                 overFlow:
   246 00000109 B804000000             mov eax, 4
   247 0000010E EB06                   jmp done
   248                                 
   249                                 success:
   250 00000110 B800000000             mov eax, 0
   251 00000115 4C8933                 mov qword [rbx], r14
   252                                 
   253                                 done:
   254 00000118 59                     pop rcx
   255 00000119 415E                   pop r14
   256 0000011B 415B                   pop r11
   257 0000011D 415C                   pop r12
   258 0000011F 5B                     pop rbx
   259 00000120 5A                     pop rdx
   260 00000121 5E                     pop rsi
   261 00000122 5F                     pop rdi
   262                                 
   263                                 
   264 00000123 C3                     ret
   265                                 
   266                                 
   267                                 
   268                                 
   269                                 
   270                                 
   271                                 
   272                                 
   273                                 
   274                                 
   275                                 
   276                                 
   277                                 
   278                                 
   279                                 
   280                                 
   281                                 
   282                                 
   283                                 
   284                                 
   285                                 
   286                                 
   287                                 
   288                                 
   289                                 
   290                                 
   291                                 
   292                                 
   293                                 
   294                                 
   295                                 
   296                                 
   297                                 
   298                                 
   299                                 
   300                                 
   301                                 
   302                                 
   303                                 
   304                                 
   305                                 
   306                                 
   307                                 [global oddEvenSort]
   308                                 oddEvenSort:
   309                                 
   310 00000124 4154                   push r12
   311 00000126 4155                   push r13
   312 00000128 53                     push rbx
   313 00000129 51                     push rcx
   314 0000012A 4157                   push r15
   315                                 
   316                                 while:
   317 0000012C 41B701                 mov r15b, 1
   318 0000012F 49C7C401000000         mov r12, 1
   319 00000136 4189F5                 mov r13d, esi
   320 00000139 4183ED01               sub r13d, 1
   321                                 
   322                                 forLoop1:
   323 0000013D 4539EC                 cmp r12d, r13d
   324 00000140 731D                   jae nextLoop
   325                                 
   326                                 
   327 00000142 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   328 00000146 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   329                                 
   330 0000014B 39CB                   cmp ebx, ecx
   331 0000014D 760A                   jbe continue1
   332                                 
   333 0000014F 42890CA7               mov dword [rdi + r12 * 4], ecx
   334 00000153 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   335 00000158 41B700                 mov r15b, 0
   336                                 
   337                                 continue1:
   338 0000015B 4983C402               add r12, 2
   339 0000015F EBDA                   jmp forLoop1
   340                                 nextLoop:
   341 00000161 49C7C400000000         mov r12, 0
   342                                 
   343                                 forLoop2:
   344 00000168 4539EC                 cmp r12d, r13d
   345 0000016B 731D                   jae whileCondition
   346                                 
   347                                 
   348 0000016D 428B1CA7               mov ebx, dword [rdi + r12 * 4]
   349 00000171 428B4CA704             mov ecx, dword [rdi + ((r12 * 4) + 4)]
   350                                 
   351 00000176 39CB                   cmp ebx, ecx
   352 00000178 760A                   jbe continue2
   353                                 
   354 0000017A 42890CA7               mov dword [rdi + r12 * 4], ecx
   355 0000017E 42895CA704             mov dword [rdi + ((r12 * 4) + 4)], ebx
   356 00000183 41B700                 mov r15b, 0
   357                                 
   358                                 continue2:
   359 00000186 4983C402               add r12, 2
   360 0000018A EBDA                   jmp forLoop2
   361                                 whileCondition:
   362 0000018C 4180FF00               cmp r15b, 0
   363 00000190 7498                   je while
   364                                 
   365 00000192 415F                   pop r15
   366 00000194 59                     pop rcx
   367 00000195 5A                     pop rdx
   368 00000196 415D                   pop r13
   369 00000198 415C                   pop r12
   370                                 
   371 0000019A C3                     ret
   372                                 
   373                                 
   374                                 
   375                                 
   376                                 
   377                                 
   378                                 
   379                                 
   380                                 
   381                                 
   382                                 
   383                                 
   384                                 
   385                                 
   386                                 
   387                                 
   388                                 
   389                                 
   390                                 
   391                                 
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 [global listStats]
   402                                 listStats:
   403                                 
   404                                 
   405                                 
   406 0000019B 55                      push rbp
   407 0000019C 4889E5                  mov rbp, rsp
   408 0000019F 4154                    push r12
   409 000001A1 4155                    push r13
   410                                 
   411 000001A3 448B27                  mov r12d, dword [rdi]
   412 000001A6 448921                  mov dword [rcx], r12d
   413 000001A9 448B64B7FC              mov r12d, dword [rdi + ((rsi * 4) - 4)]
   414 000001AE 448922                  mov dword [rdx], r12d
   415                                 
   416 000001B1 49C7C400000000          mov r12, 0
   417 000001B8 49C7C500000000          mov r13, 0
   418                                  sumLoop:
   419 000001BF 46032CA7                add r13d, dword [rdi + r12 * 4]
   420 000001C3 49FFC4                  inc r12
   421 000001C6 4939F4                  cmp r12, rsi
   422 000001C9 72F2                    jb sumLoop
   423 000001CB 458929                  mov dword [r9], r13d
   424                                 
   425 000001CE 4C8D6D10                lea r13, dword [rbp + 16]
   426 000001D2 418B01                  mov eax, dword [r9]
   427 000001D5 99                      cdq
   428 000001D6 F7F6                    div esi
   429 000001D8 41894500                mov dword [r13], eax
   430                                 
   431                                 
   432 000001DC 52                      push rdx
   433 000001DD 89F0                    mov eax, esi
   434 000001DF 99                      cdq
   435 000001E0 49C7C402000000          mov r12, 2
   436 000001E7 49F7F4                  div r12
   437 000001EA 4883FA01                cmp rdx, 1
   438 000001EE 750B                    jne evenLength1
   439                                 
   440 000001F0 4D89C5                  mov r13, r8
   441 000001F3 448B2487                mov r12d, dword [rdi + rax * 4]
   442 000001F7 45896500                mov dword [r13], r12d
   443 000001FB EB18                    jmp statsDone
   444                                 
   445                                  evenLength1:
   446 000001FD 49C7C400000000          mov r12, 0
   447 00000204 448B2487                mov r12d, dword [rdi + rax * 4]
   448 00000208 44036487FC              add r12d, dword [rdi + ((rax * 4) - 4)]
   449 0000020D 41D1EC                  shr r12d, 1
   450 00000210 4D89C5                  mov r13, r8
   451 00000213 45896500                mov dword [r13], r12d
   452                                 
   453                                  statsDone:
   454 00000217 5A                      pop rdx
   455 00000218 415D                    pop r13
   456 0000021A 415C                    pop r12
   457 0000021C 5D                      pop rbp
   458                                 
   459 0000021D C3                      ret
   460                                 
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 
   466                                 
   467                                 
   468                                 
   469                                 
   470                                 
   471                                 
   472                                 
   473                                 
   474                                 
   475                                 
   476                                 
   477                                 
   478                                 
   479                                 
   480                                 
   481                                 
   482                                 
   483                                 [global estimatedMedian]
   484                                 estimatedMedian:
   485                                 
   486                                 
   487                                 
   488 0000021E 52                      push rdx
   489 0000021F 4154                    push r12
   490 00000221 89F0                    mov eax, esi
   491 00000223 99                      cdq
   492 00000224 49C7C402000000          mov r12, 2
   493 0000022B 41F7F4                  div r12d
   494 0000022E 4883FA01                cmp rdx, 1
   495 00000232 750A                    jne evenLength2
   496                                 
   497                                 
   498 00000234 4989F4                  mov r12, rsi
   499 00000237 49D1EC                  shr r12, 1
   500 0000023A 428B04A7                mov eax, dword [rdi + r12 * 4]
   501 0000023E EB0F                    jmp medianDone
   502                                 
   503                                  evenLength2:
   504 00000240 4989F4                  mov r12, rsi
   505 00000243 49D1EC                  shr r12, 1
   506 00000246 428B04A7                mov eax, dword [rdi + r12 * 4]
   507 0000024A 420344A7FC              add eax, dword [rdi + ((r12 * 4) - 4)]
   508 0000024F D1E8                    shr eax, 1
   509                                 
   510                                  medianDone:
   511 00000251 415C                    pop r12
   512 00000253 5A                      pop rdx
   513                                 
   514 00000254 C3                      ret
   515                                 
   516                                 
   517                                 
   518                                 
   519                                 
   520                                 
   521                                 
   522                                 
   523                                 
   524                                 
   525                                 
   526                                 
   527                                 
   528                                 
   529                                 
   530                                 
   531                                 
   532                                 
   533                                 
   534                                 
   535                                 
   536                                 
   537                                 
   538                                 
   539                                 
   540                                 
   541                                 
   542                                 
   543                                 [global estimatedSkew]
   544                                 estimatedSkew:
   545                                 
   546                                 
   547                                 
   548                                 
   549                                 
   550 00000255 4154                    push r12
   551 00000257 4155                    push r13
   552 00000259 4156                    push r14
   553 0000025B 4157                    push r15
   554 0000025D 4152                    push r10
   555                                 
   556 0000025F 49C7C400000000          mov r12, 0
   557 00000266 4989F6                  mov r14, rsi
   558 00000269 49FFCE                  dec r14
   559 0000026C 49C7C700000000          mov r15, 0
   560 00000273 49C7C200000000          mov r10, 0
   561                                 
   562                                  skewLoop:
   563                                 
   564 0000027A 428B04A7                mov eax, dword [rdi + r12 * 4]
   565 0000027E 29D0                    sub eax, edx
   566 00000280 52                      push rdx
   567 00000281 99                      cdq
   568 00000282 F7E0                    mul eax
   569 00000284 4189C7                  mov r15d, eax
   570 00000287 4D89FD                  mov r13, r15
   571 0000028A 4D01EA                  add r10, r13
   572 0000028D 5A                      pop rdx
   573 0000028E 49FFC4                  inc r12
   574 00000291 4D39F4                  cmp r12, r14
   575 00000294 76E2                    jbe skewLoop
   576                                 
   577 00000296 90                      nop
   578 00000297 49C7C403000000          mov r12, 3
   579 0000029E 89F0                    mov eax, esi
   580 000002A0 41F7E4                  mul r12d
   581 000002A3 4989C4                  mov r12, rax
   582 000002A6 4C89D0                  mov rax, r10
   583 000002A9 4899                    cqo
   584 000002AB 49F7F4                  div r12
   585 000002AE 90                      nop
   586 000002AF 415A                    pop r10
   587 000002B1 415F                    pop r15
   588 000002B3 415E                    pop r14
   589 000002B5 415D                    pop r13
   590 000002B7 415C                    pop r12
   591                                 
   592 000002B9 C3                      ret
   593                                 
   594                                 
   595                                 
